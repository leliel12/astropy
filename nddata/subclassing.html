<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Subclassing &mdash; Astropy v1.2.dev15690</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.dev15690',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev15690" href="../index.html" />
    <link rel="up" title="N-dimensional datasets (astropy.nddata)" href="index.html" />
    <link rel="next" title="astropy.nddata.utils" href="utils.html" />
    <link rel="prev" title="I/O mixin" href="mixins/ndio.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="utils.html" title="astropy.nddata.utils">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="mixins/ndio.html" title="I/O mixin">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v1.2.dev15690</a>
	 &raquo;
      </li>
      <li><a href="index.html" accesskey="U">N-dimensional datasets (<code class="docutils literal"><span class="pre">astropy.nddata</span></code>)</a> &raquo;</li>
      
      <li>Subclassing</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="subclassing">
<span id="nddata-subclassing"></span><h1>Subclassing<a class="headerlink" href="#subclassing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="nddata">
<h2><a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal"><span class="pre">NDData</span></code></a><a class="headerlink" href="#nddata" title="Permalink to this headline">¶</a></h2>
<p>This class serves as the base for subclasses that use a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.11)"><code class="xref py py-obj docutils literal"><span class="pre">numpy.ndarray</span></code></a> (or
something that presents a numpy-like interface) as the <code class="docutils literal"><span class="pre">data</span></code> attribute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each attribute is saved as attribute with one leading underscore. For example
the <code class="docutils literal"><span class="pre">data</span></code> is saved as <code class="docutils literal"><span class="pre">_data</span></code> and the <code class="docutils literal"><span class="pre">mask</span></code> as <code class="docutils literal"><span class="pre">_mask</span></code>, and so on.</p>
</div>
<div class="section" id="adding-another-property">
<h3>Adding another property<a class="headerlink" href="#adding-another-property" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDData</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="bp">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">NDDataWithFlags</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">flags</span>
<span class="go">[0, 0.2, 0.3]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To simplify subclassing each setter (except for <code class="docutils literal"><span class="pre">data</span></code>) is called during
<code class="docutils literal"><span class="pre">__init__</span></code> so putting restrictions on any attribute can be done inside
the setter and will also apply duing instance creation.</p>
</div>
</div>
<div class="section" id="customize-the-setter-for-a-property">
<h3>Customize the setter for a property<a class="headerlink" href="#customize-the-setter-for-a-property" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataMaskBoolNumpy</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData.mask.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Convert mask to boolean numpy array.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataMaskBoolNumpy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array(True, dtype=bool)</span>
</pre></div>
</div>
</div>
<div class="section" id="extend-the-setter-for-a-property">
<h3>Extend the setter for a property<a class="headerlink" href="#extend-the-setter-for-a-property" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">unit</span></code>, <code class="docutils literal"><span class="pre">meta</span></code> and <code class="docutils literal"><span class="pre">uncertainty</span></code> implement some additional logic in their
setter so subclasses might define a call to the superclass and let the
super property set the attribute afterwards:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataUncertaintyShapeChecker</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData.uncertainty.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;uncertainty must have the same shape as the data.&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c"># Call the setter of the super class in case it might contain some</span>
<span class="gp">... </span>        <span class="c"># important logic (only True for meta, unit and uncertainty)</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">NDDataUncertaintyShapeChecker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataUncertaintyShapeChecker</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="go">INFO: uncertainty should have attribute uncertainty_type. [astropy.nddata.nddata]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">UnknownUncertainty([2, 3, 4])</span>
</pre></div>
</div>
</div>
<div class="section" id="having-a-setter-for-the-data">
<h3>Having a setter for the data<a class="headerlink" href="#having-a-setter-for-the-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithDataSetter</span><span class="p">(</span><span class="n">NDData</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@NDData.data.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithDataSetter</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([3, 2, 1])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nddataref">
<h2><a class="reference internal" href="../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a><a class="headerlink" href="#nddataref" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a> itself inherits from <a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal"><span class="pre">NDData</span></code></a> so
any of the possibilities there also apply to NDDataRef. But NDDataRef also
inherits from the Mixins:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/astropy.nddata.NDSlicingMixin.html#astropy.nddata.NDSlicingMixin" title="astropy.nddata.NDSlicingMixin"><code class="xref py py-obj docutils literal"><span class="pre">NDSlicingMixin</span></code></a></li>
<li><a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin" title="astropy.nddata.NDArithmeticMixin"><code class="xref py py-obj docutils literal"><span class="pre">NDArithmeticMixin</span></code></a></li>
<li><a class="reference internal" href="../api/astropy.nddata.NDIOMixin.html#astropy.nddata.NDIOMixin" title="astropy.nddata.NDIOMixin"><code class="xref py py-obj docutils literal"><span class="pre">NDIOMixin</span></code></a></li>
</ul>
<p>which allow additional operations.</p>
<div class="section" id="add-another-arithmetic-operation">
<h3>Add another arithmetic operation<a class="headerlink" href="#add-another-arithmetic-operation" title="Permalink to this headline">¶</a></h3>
<p>Adding another possible operations is quite easy provided the <code class="docutils literal"><span class="pre">data</span></code> and
<code class="docutils literal"><span class="pre">unit</span></code> allow it within the framework of <a class="reference internal" href="../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal"><span class="pre">Quantity</span></code></a>.</p>
<p>For example adding a power function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.utils</span> <span class="kn">import</span> <span class="n">sharedmethod</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataPower</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@sharedmethod</span> <span class="c"># sharedmethod to allow it also as classmethod</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">operand2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># the uncertainty doesn&#39;t allow propagation so set it to None</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;propagate_uncertainties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">... </span>        <span class="c"># Call the _prepare_then_do_arithmetic function with the</span>
<span class="gp">... </span>        <span class="c"># numpy.power ufunc.</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_then_do_arithmetic</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span>
<span class="gp">... </span>                                                <span class="n">operand2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be used like the other arithmetic methods like
<a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.add" title="astropy.nddata.NDArithmeticMixin.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a>. So it works when calling it
on the class or the instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataPower</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># using it on the instance with one operand</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">NDDataPower([ 1,  8, 27])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># using it on the instance with two operands</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">pow</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="go">NDDataPower([  1,  16, 243])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># or using it as classmethod</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataPower</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="go">NDDataPower([  6,  36, 216])</span>
</pre></div>
</div>
<p>To allow propagation also with <code class="docutils literal"><span class="pre">uncertainty</span></code> see subclassing
<a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">NDUncertainty</span></code></a>.</p>
<p>The <code class="docutils literal"><span class="pre">_prepare_then_do_arithmetic</span></code> implements the relevant checks if it was
called on the class or the instance, and, if one or two operands were given,
and converts the operands, if necessary, to the appropriate classes. Overriding
<code class="docutils literal"><span class="pre">_prepare_then_do_arithmetic</span></code> in subclasses should be avoided if
possible.</p>
</div>
<div class="section" id="arithmetic-on-an-existing-property">
<h3>Arithmetic on an existing property<a class="headerlink" href="#arithmetic-on-an-existing-property" title="Permalink to this headline">¶</a></h3>
<p>Customizing how an existing property is handled during arithmetic is possible
with some arguments to the function calls like
<a class="reference internal" href="../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.add" title="astropy.nddata.NDArithmeticMixin.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a> but it&#8217;s possible to hardcode
behaviour too. The actual operation on the attribute (except for <code class="docutils literal"><span class="pre">unit</span></code>) is
done in a method <code class="docutils literal"><span class="pre">_arithmetic_*</span></code> where <code class="docutils literal"><span class="pre">*</span></code> is the name of the property.</p>
<p>For example to customize how the <code class="docutils literal"><span class="pre">meta</span></code> will be affected during arithmetics:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithMetaArithmetics</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="n">handle_mask</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># the function must take the arguments:</span>
<span class="gp">... </span>        <span class="c"># operation (numpy-ufunc like np.add, np.subtract, ...)</span>
<span class="gp">... </span>        <span class="c"># operand (the other NDData-like object, already wrapped as NDData)</span>
<span class="gp">... </span>        <span class="c"># handle_mask (see description for &quot;add&quot;)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># The meta is dict like but we want the keywords exposure to change</span>
<span class="gp">... </span>        <span class="c"># Anticipate that one or both might have no meta and take the first one that has</span>
<span class="gp">... </span>        <span class="n">result_meta</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="k">else</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">operand</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c"># Do the operation on the keyword if the keyword exists</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">result_meta</span> <span class="ow">and</span> <span class="s">&#39;exposure&#39;</span> <span class="ow">in</span> <span class="n">result_meta</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">result_meta</span><span class="p">[</span><span class="s">&#39;exposure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="n">result_meta</span><span class="p">[</span><span class="s">&#39;exposure&#39;</span><span class="p">],</span> <span class="n">operand</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">result_meta</span> <span class="c"># return it</span>
</pre></div>
</div>
<p>To trigger this method the <code class="docutils literal"><span class="pre">handle_meta</span></code> argument to arithmetic methods can
be anything except <code class="docutils literal"><span class="pre">None</span></code> or <code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithMetaArithmetics</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;exposure&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">ndd</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span><span class="o">.</span><span class="n">meta</span>
<span class="go">{&#39;exposure&#39;: 20}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span> <span class="o">=</span> <span class="n">ndd</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span><span class="o">.</span><span class="n">meta</span>
<span class="go">{&#39;exposure&#39;: 5.0}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>To use these internal <code class="xref py py-obj docutils literal"><span class="pre">_arithmetic_*</span></code> methods there are some restrictions on
the attributes when calling the operation:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">mask</span></code>: <code class="docutils literal"><span class="pre">handle_mask</span></code> must not be <code class="docutils literal"><span class="pre">None</span></code>, <code class="docutils literal"><span class="pre">&quot;ff&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">wcs</span></code>: <code class="docutils literal"><span class="pre">compare_wcs</span></code> argument with the same restrictions as mask.</li>
<li><code class="docutils literal"><span class="pre">meta</span></code>: <code class="docutils literal"><span class="pre">handle_meta</span></code> argument with the same restrictions as mask.</li>
<li><code class="docutils literal"><span class="pre">uncertainty</span></code>: <code class="docutils literal"><span class="pre">propagate_uncertainties</span></code> must be <code class="docutils literal"><span class="pre">None</span></code> or evaluate
to <code class="docutils literal"><span class="pre">False</span></code>. <code class="docutils literal"><span class="pre">arithmetic_uncertainty</span></code> must also accepts different
arguments: <code class="docutils literal"><span class="pre">operation,</span> <span class="pre">operand,</span> <span class="pre">result,</span> <span class="pre">correlation,</span> <span class="pre">**kwargs</span></code></li>
</ul>
</div>
</div>
<div class="section" id="changing-default-argument-for-arithmetic-operations">
<h3>Changing default argument for arithmetic operations<a class="headerlink" href="#changing-default-argument-for-arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<p>If the goal is to change the default value of an existing parameter for
arithmetic methods, maybe because explicitly specifying the parameter each
time you&#8217;re calling an arithmetic operation is too much effort, you can easily
change the default value of existing parameters by changing it in the method
signature of <code class="docutils literal"><span class="pre">_arithmetic</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDDiffAritDefaults</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Changing the default of handle_mask to None</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="s">&#39;handle_mask&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;handle_mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="gp">... </span>        <span class="c"># Call the original with the updated kwargs</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NDDDiffAritDefaults</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_arithmetic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDDiffAritDefaults</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDDiffAritDefaults</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span>  <span class="c"># it will be None</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># But giving other values is still possible:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="s">&quot;ff&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The parameter controlling how properties are handled are all keyword-only
so using the <code class="docutils literal"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> approach allows one to only alter one default
without needing to care about the positional order of arguments. But using
<code class="docutils literal"><span class="pre">def</span> <span class="pre">_arithmetic(self,</span> <span class="pre">*args,</span> <span class="pre">handle_mask=None,</span> <span class="pre">**kwargs)</span></code> doesn&#8217;t work
for python 2.</p>
</div>
<div class="section" id="arithmetic-with-an-additional-property">
<h3>Arithmetic with an additional property<a class="headerlink" href="#arithmetic-with-an-additional-property" title="Permalink to this headline">¶</a></h3>
<p>This also requires overriding the <code class="docutils literal"><span class="pre">_arithmetic</span></code> method. Suppose we have a
<code class="docutils literal"><span class="pre">flags</span></code> attribute again:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="bp">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">NDDataWithFlags</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_arithmetic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># take all args and kwargs to allow arithmetic on the other properties</span>
<span class="gp">... </span>        <span class="c"># to work like before.</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># do the arithmetics on the flags (pop the relevant kwargs, if any!!!)</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">operand</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">result_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="n">operand</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">... </span>            <span class="c"># np.logical_or is just a suggestion you can do what you want</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">result_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>                <span class="n">result_flags</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">operand</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># Let the superclass do all the other attributes note that</span>
<span class="gp">... </span>        <span class="c"># this returns the result and a dictionary containing other attributes</span>
<span class="gp">... </span>        <span class="n">result</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NDDataWithFlags</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_arithmetic</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c"># The arguments for creating a new instance are saved in kwargs</span>
<span class="gp">... </span>        <span class="c"># so we need to add another keyword &quot;flags&quot; and add the processed flags</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_flags</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">kwargs</span> <span class="c"># these must be returned</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span><span class="o">.</span><span class="n">flags</span>
<span class="go">array([ True, False,  True], dtype=bool)</span>
</pre></div>
</div>
</div>
<div class="section" id="slicing-an-existing-property">
<h3>Slicing an existing property<a class="headerlink" href="#slicing-an-existing-property" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have a class expecting a 2 dimensional <code class="docutils literal"><span class="pre">data</span></code> but the mask is
only 1D. This would lead to problems if one were to slice in two dimensions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataMask1D</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_slice_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Multidimensional slices are represented by tuples:</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="gp">... </span>            <span class="c"># only use the first dimension of the slice</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">... </span>        <span class="c"># Let the superclass deal with the other cases</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NDDataMask1D</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_slice_mask</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataMask1D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nddsliced</span> <span class="o">=</span> <span class="n">ndd</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nddsliced</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True,  True], dtype=bool)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The methods doing the slicing of the attributes are prefixed by a
<code class="docutils literal"><span class="pre">_slice_*</span></code> where <code class="docutils literal"><span class="pre">*</span></code> can be <code class="docutils literal"><span class="pre">mask</span></code>, <code class="docutils literal"><span class="pre">uncertainty</span></code> or <code class="docutils literal"><span class="pre">wcs</span></code>. So
simply overriding them is the easiest way to customize how the are sliced.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If slicing should affect the <code class="docutils literal"><span class="pre">unit</span></code> or <code class="docutils literal"><span class="pre">meta</span></code> see the next example.</p>
</div>
</div>
<div class="section" id="slicing-an-additional-property">
<h3>Slicing an additional property<a class="headerlink" href="#slicing-an-additional-property" title="Permalink to this headline">¶</a></h3>
<p>Building on the added property <code class="docutils literal"><span class="pre">flags</span></code> we want them to be sliceable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataWithFlags</span><span class="p">(</span><span class="n">NDDataRef</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Remove flags attribute if given and pass it to the setter.</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;flags&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="bp">None</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">(</span><span class="n">NDDataWithFlags</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@flags.setter</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># slice all normal attributes</span>
<span class="gp">... </span>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NDDataWithFlags</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_slice</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="gp">... </span>        <span class="c"># The arguments for creating a new instance are saved in kwargs</span>
<span class="gp">... </span>        <span class="c"># so we need to add another keyword &quot;flags&quot; and add the sliced flags</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">kwargs</span> <span class="c"># these must be returned</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataWithFlags</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">ndd</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span><span class="o">.</span><span class="n">flags</span>
<span class="go">[0.2, 0.3]</span>
</pre></div>
</div>
<p>If you wanted to keep just the original <code class="docutils literal"><span class="pre">flags</span></code> instead of the sliced ones
you could use <code class="docutils literal"><span class="pre">kwargs['flags']</span> <span class="pre">=</span> <span class="pre">self.flags</span></code> and omit the <code class="docutils literal"><span class="pre">[item]</span></code>.</p>
</div>
</div>
<div class="section" id="nddatabase">
<h2><a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal"><span class="pre">NDDataBase</span></code></a><a class="headerlink" href="#nddatabase" title="Permalink to this headline">¶</a></h2>
<p>The class <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal"><span class="pre">NDDataBase</span></code></a> is a metaclass &#8211; when subclassing it,
all properties of <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal"><span class="pre">NDDataBase</span></code></a> <em>must</em> be overriden in the
subclass.</p>
<p>Subclassing from <a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal"><span class="pre">NDDataBase</span></code></a> gives you complete flexibility
in how you implement data storage and the other properties. If your data is
stored in a numpy array (or something that behaves like a numpy array), it may
be more straightforward to subclass <a class="reference internal" href="../api/astropy.nddata.NDData.html#astropy.nddata.NDData" title="astropy.nddata.NDData"><code class="xref py py-obj docutils literal"><span class="pre">NDData</span></code></a> instead of
<a class="reference internal" href="../api/astropy.nddata.NDDataBase.html#astropy.nddata.NDDataBase" title="astropy.nddata.NDDataBase"><code class="xref py py-obj docutils literal"><span class="pre">NDDataBase</span></code></a>.</p>
<div class="section" id="implementing-the-nddatabase-interface">
<h3>Implementing the NDDataBase interface<a class="headerlink" href="#implementing-the-nddatabase-interface" title="Permalink to this headline">¶</a></h3>
<p>For example to create a readonly container:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataBase</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">NDDataReadOnlyNoRestrictions</span><span class="p">(</span><span class="n">NDDataBase</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">uncertainty</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">wcs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">unit</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span> <span class="o">=</span> <span class="n">mask</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span> <span class="o">=</span> <span class="n">uncertainty</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">meta</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_wcs</span> <span class="o">=</span> <span class="n">wcs</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncertainty</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">wcs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wcs</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># A meaningless test to show that creating this class is possible:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataReadOnlyNoRestrictions</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Actually defining an <code class="docutils literal"><span class="pre">__init__</span></code> is not necessary and the properties could
return arbitary values but the properties <strong>must</strong> be defined.</p>
</div>
</div>
</div>
<div class="section" id="subclassing-nduncertainty">
<h2>Subclassing <a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">NDUncertainty</span></code></a><a class="headerlink" href="#subclassing-nduncertainty" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The internal interface of NDUncertainty and subclasses is experimental and
might change in future versions.</p>
</div>
<p>Subclasses deriving from <a class="reference internal" href="../api/astropy.nddata.NDUncertainty.html#astropy.nddata.NDUncertainty" title="astropy.nddata.NDUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">NDUncertainty</span></code></a> need to implement:</p>
<ul class="simple">
<li>property <code class="docutils literal"><span class="pre">uncertainty_type</span></code>, should return a string describing the
uncertainty for example <code class="docutils literal"><span class="pre">&quot;ivar&quot;</span></code> for inverse variance.</li>
<li>methods for propagation: <code class="xref py py-obj docutils literal"><span class="pre">_propagate_*</span></code> where <code class="docutils literal"><span class="pre">*</span></code> is the name of the UFUNC
that is used on the <code class="docutils literal"><span class="pre">NDData</span></code> parent.</li>
</ul>
<div class="section" id="creating-an-uncertainty-without-propagation">
<h3>Creating an uncertainty without propagation<a class="headerlink" href="#creating-an-uncertainty-without-propagation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../api/astropy.nddata.UnknownUncertainty.html#astropy.nddata.UnknownUncertainty" title="astropy.nddata.UnknownUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">UnknownUncertainty</span></code></a> is a minimal working implementation
without error propagation. So let&#8217;s create an uncertainty just storing
systematic uncertainties:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDUncertainty</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SystematicUncertainty</span><span class="p">(</span><span class="n">NDUncertainty</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;systematic&#39;</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">None</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">SystematicUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">])</span>
<span class="go">SystematicUncertainty([10])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="subclassing-stddevuncertainty">
<h2>Subclassing <a class="reference internal" href="../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a><a class="headerlink" href="#subclassing-stddevuncertainty" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-an-variance-uncertainty">
<h3>Creating an variance uncertainty<a class="headerlink" href="#creating-an-variance-uncertainty" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a> already implements propagation based
on gaussian standard deviation so this could be the starting point of an
uncertainty using these propagations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">weakref</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">VarianceUncertainty</span><span class="p">(</span><span class="n">StdDevUncertainty</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">uncertainty_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s">&#39;variance&#39;</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_propagate_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c"># Neglect the unit assume that both are Variance uncertainties</span>
<span class="gp">... </span>        <span class="n">this</span> <span class="o">=</span> <span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">other</span> <span class="o">=</span> <span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># We need to set the parent_nddata attribute otherwise it will</span>
<span class="gp">... </span>        <span class="c"># fail for multiplication and division where the data</span>
<span class="gp">... </span>        <span class="c"># not only the uncertainty matters.</span>
<span class="gp">... </span>        <span class="n">this</span><span class="o">.</span><span class="n">parent_nddata</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_nddata</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">other</span><span class="o">.</span><span class="n">parent_nddata</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># Call propagation:</span>
<span class="gp">... </span>        <span class="n">result</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">_propagate_add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="c"># Return the square of it</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">VarianceUncertainty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">VarianceUncertainty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">VarianceUncertainty([  2.,   8.,  18.])</span>
</pre></div>
</div>
<p>this approach certainly works if both are variance uncertainties, but if you
want to allow that the second operand also can be a standard deviation one can
override the <code class="docutils literal"><span class="pre">_convert_uncertainty</span></code> method as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">VarianceUncertainty2</span><span class="p">(</span><span class="n">VarianceUncertainty</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_convert_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_uncert</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">VarianceUncertainty</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">other_uncert</span>
<span class="gp">... </span>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_uncert</span><span class="p">,</span> <span class="n">StdDevUncertainty</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">converted</span> <span class="o">=</span> <span class="n">VarianceUncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
<span class="gp">... </span>            <span class="n">converted</span><span class="o">.</span><span class="n">parent_nddata</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">other_uncert</span><span class="o">.</span><span class="n">parent_nddata</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">return</span> <span class="n">converted</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;not compatible uncertainties.&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">VarianceUncertainty2</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">VarianceUncertainty2([  2.,   8.,  18.])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This will only allow the <strong>second</strong> operand to have a
<a class="reference internal" href="../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a> uncertainty. It will fail if the first
operand is standard deviation and the second operand a variance.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Creating a variance uncertainty like this might require more work to
include proper treatement of the unit of the uncertainty! And of course
implementing also the <code class="docutils literal"><span class="pre">_propagate_*</span></code> for subtraction, division and
multiplication.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Subclassing</a><ul>
<li><a class="reference internal" href="#nddata"><code class="docutils literal"><span class="pre">NDData</span></code></a><ul>
<li><a class="reference internal" href="#adding-another-property">Adding another property</a></li>
<li><a class="reference internal" href="#customize-the-setter-for-a-property">Customize the setter for a property</a></li>
<li><a class="reference internal" href="#extend-the-setter-for-a-property">Extend the setter for a property</a></li>
<li><a class="reference internal" href="#having-a-setter-for-the-data">Having a setter for the data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nddataref"><code class="docutils literal"><span class="pre">NDDataRef</span></code></a><ul>
<li><a class="reference internal" href="#add-another-arithmetic-operation">Add another arithmetic operation</a></li>
<li><a class="reference internal" href="#arithmetic-on-an-existing-property">Arithmetic on an existing property</a></li>
<li><a class="reference internal" href="#changing-default-argument-for-arithmetic-operations">Changing default argument for arithmetic operations</a></li>
<li><a class="reference internal" href="#arithmetic-with-an-additional-property">Arithmetic with an additional property</a></li>
<li><a class="reference internal" href="#slicing-an-existing-property">Slicing an existing property</a></li>
<li><a class="reference internal" href="#slicing-an-additional-property">Slicing an additional property</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nddatabase"><code class="docutils literal"><span class="pre">NDDataBase</span></code></a><ul>
<li><a class="reference internal" href="#implementing-the-nddatabase-interface">Implementing the NDDataBase interface</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subclassing-nduncertainty">Subclassing <code class="docutils literal"><span class="pre">NDUncertainty</span></code></a><ul>
<li><a class="reference internal" href="#creating-an-uncertainty-without-propagation">Creating an uncertainty without propagation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subclassing-stddevuncertainty">Subclassing <code class="docutils literal"><span class="pre">StdDevUncertainty</span></code></a><ul>
<li><a class="reference internal" href="#creating-an-variance-uncertainty">Creating an variance uncertainty</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/nddata/subclassing.rst">Edit This Page on Github</a> &nbsp;
    <a href="../_sources/nddata/subclassing.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 10 Jun 2016. <br/>
  </p>
</footer>
  </body>
</html>