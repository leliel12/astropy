<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>NDData Arithmetic &mdash; Astropy v1.2.dev15690</title>
    
    <link rel="stylesheet" href="../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.dev15690',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev15690" href="../../index.html" />
    <link rel="up" title="Mixins for added functionality" href="index.html" />
    <link rel="next" title="I/O mixin" href="ndio.html" />
    <link rel="prev" title="Slicing and Indexing NDData" href="ndslicing.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="ndio.html" title="I/O mixin">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="ndslicing.html" title="Slicing and Indexing NDData">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">Astropy v1.2.dev15690</a>
	 &raquo;
      </li>
      <li><a href="../index.html" >N-dimensional datasets (<code class="docutils literal"><span class="pre">astropy.nddata</span></code>)</a> &raquo;</li>
      <li><a href="index.html" accesskey="U">Mixins for added functionality</a> &raquo;</li>
      
      <li>NDData Arithmetic</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="nddata-arithmetic">
<span id="id1"></span><h1>NDData Arithmetic<a class="headerlink" href="#nddata-arithmetic" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a> implements the following arithmetic operations:</p>
<ul class="simple">
<li>addition: <a class="reference internal" href="../../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.add" title="astropy.nddata.NDArithmeticMixin.add"><code class="xref py py-meth docutils literal"><span class="pre">add()</span></code></a></li>
<li>subtraction: <a class="reference internal" href="../../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.subtract" title="astropy.nddata.NDArithmeticMixin.subtract"><code class="xref py py-meth docutils literal"><span class="pre">subtract()</span></code></a></li>
<li>multiplication: <a class="reference internal" href="../../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.multiply" title="astropy.nddata.NDArithmeticMixin.multiply"><code class="xref py py-meth docutils literal"><span class="pre">multiply()</span></code></a></li>
<li>division: <a class="reference internal" href="../../api/astropy.nddata.NDArithmeticMixin.html#astropy.nddata.NDArithmeticMixin.divide" title="astropy.nddata.NDArithmeticMixin.divide"><code class="xref py py-meth docutils literal"><span class="pre">divide()</span></code></a></li>
</ul>
</div>
<div class="section" id="using-basic-arithmetic-methods">
<h2>Using basic arithmetic methods<a class="headerlink" href="#using-basic-arithmetic-methods" title="Permalink to this headline">¶</a></h2>
<p>Using the standard arithmetic methods requires that the first operand
is an <a class="reference internal" href="../../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a> instance</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">NDDataRef</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<p>while the requirement for the second operand is simply: It must be convertible
to the first operand. It can be a number:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">NDDataRef([4, 5, 6, 7])</span>
</pre></div>
</div>
<p>or a <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.5)"><code class="xref py py-obj docutils literal"><span class="pre">list</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="go">NDDataRef([0, 1, 2, 3])</span>
</pre></div>
</div>
<p>a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.11)"><code class="xref py py-obj docutils literal"><span class="pre">numpy.ndarray</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="go">NDDataRef([ 4, 10, 18, 28])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>  <span class="c"># a 3 x 4 numpy array</span>
<span class="go">NDDataRef([[ 1.        ,  1.        ,  1.        ,  1.        ],</span>
<span class="go">           [ 0.2       ,  0.33333333,  0.42857143,  0.5       ],</span>
<span class="go">           [ 0.11111111,  0.2       ,  0.27272727,  0.33333333]])</span>
</pre></div>
</div>
<p>here broadcasting takes care of the different dimensions. Also several other
classes are possible.</p>
</div>
<div class="section" id="using-arithmetic-classmethods">
<h2>Using arithmetic classmethods<a class="headerlink" href="#using-arithmetic-classmethods" title="Permalink to this headline">¶</a></h2>
<p>Here both operands don&#8217;t need to be <a class="reference internal" href="../../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a>-like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataRef</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">NDDataRef(4)</span>
</pre></div>
</div>
<p>or to wrap the result of an arithmetic operation between two Quantities:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="o">.</span><span class="n">multiply</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span>
<span class="go">NDDataRef([ 10.,  40.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">unit</span>
<span class="go">Unit(&quot;cm m&quot;)</span>
</pre></div>
</div>
<p>or taking the inverse of a <a class="reference internal" href="../../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a> object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">NDDataRef</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndd1</span><span class="p">)</span>
<span class="go">NDDataRef([ 1.        ,  0.5       ,  0.33333333,  0.25      ])</span>
</pre></div>
</div>
<div class="section" id="possible-operands">
<h3>Possible operands<a class="headerlink" href="#possible-operands" title="Permalink to this headline">¶</a></h3>
<p>The possible types of input for operands are:</p>
<ul class="simple">
<li>scalars of any type</li>
<li>lists containing numbers (or nested lists)</li>
<li>numpy arrays</li>
<li>numpy masked arrays</li>
<li>astropy quantities</li>
<li>other nddata classes or subclasses</li>
</ul>
</div>
</div>
<div class="section" id="advanced-options">
<h2>Advanced options<a class="headerlink" href="#advanced-options" title="Permalink to this headline">¶</a></h2>
<p>The normal python operators <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, ... are not implemented because
the methods provide several options how to proceed with the additional
attributes.</p>
<div class="section" id="data-unit">
<h3>data, unit<a class="headerlink" href="#data-unit" title="Permalink to this headline">¶</a></h3>
<p>For <code class="docutils literal"><span class="pre">data</span></code> and <code class="docutils literal"><span class="pre">unit</span></code> there are no parameters. Every arithmetic
operation lets the <a class="reference internal" href="../../api/astropy.units.Quantity.html#astropy.units.Quantity" title="astropy.units.Quantity"><code class="xref py py-obj docutils literal"><span class="pre">astropy.units.Quantity</span></code></a>-framework evaluate the result
or fail and abort the operation.</p>
<p>Adding two NDData objects with the same unit works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([ 101.,  152.,  203.,   54.,  505.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">unit</span>
<span class="go">Unit(&quot;m&quot;)</span>
</pre></div>
</div>
<p>Adding two NDData objects with compatible units also works:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="n">ndd1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;pc&#39;</span><span class="p">)</span>
<span class="go">INFO: overwriting NDData&#39;s current unit with specified unit. [astropy.nddata.nddata]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;lyr&#39;</span><span class="p">)</span>
<span class="go">INFO: overwriting NDData&#39;s current unit with specified unit. [astropy.nddata.nddata]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([ -29.66013938,  -43.99020907,  -58.32027876,  -11.33006969,</span>
<span class="go">       -148.30069689])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">unit</span>
<span class="go">Unit(&quot;pc&quot;)</span>
</pre></div>
</div>
<p>this will keep by default the unit of the first operand. However units will
not be decomposed during division:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span> <span class="o">=</span> <span class="n">ndd2</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">ndd1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">data</span>
<span class="go">array([ 100.        ,   75.        ,   66.66666667,   12.5       ,  100.        ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd</span><span class="o">.</span><span class="n">unit</span>
<span class="go">Unit(&quot;lyr / pc&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="mask">
<h3>mask<a class="headerlink" href="#mask" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">handle_mask</span></code> parameter for the arithmetic operations implements what the
resulting mask will be. There are several options.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">None</span></code>, the result will have no <code class="docutils literal"><span class="pre">mask</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;ff&quot;</span></code>, the result will have the mask of the first
operand or if that is None the mask of the second operand:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="s">&quot;first_found&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd3</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="s">&quot;first_found&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">False</span>
</pre></div>
</div>
</li>
<li><p class="first">a function (or an arbitary callable) that takes at least two arguments.
For example <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.logical_or.html#numpy.logical_or" title="(in NumPy v1.11)"><code class="xref py py-obj docutils literal"><span class="pre">numpy.logical_or</span></code></a> is the default:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True, False,  True,  True], dtype=bool)</span>
</pre></div>
</div>
<p>This defaults to <code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code> in case only one <code class="docutils literal"><span class="pre">mask</span></code> is not None:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True, False, False,  True], dtype=bool)</span>
</pre></div>
</div>
<p>Custom functions are also possible:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">take_alternating_values</span><span class="p">(</span><span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">mask1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">result</span><span class="p">[</span><span class="n">start</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask1</span><span class="p">[</span><span class="n">start</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">result</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask2</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>This function is obviously non-sense but let&#8217;s see how it performs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="n">take_alternating_values</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([ True, False,  True,  True], dtype=bool)</span>
</pre></div>
</div>
<p>Additional parameters can be given by prefixing them with <code class="docutils literal"><span class="pre">mask_</span></code>
(which will be stripped before passing it to the function):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="n">take_alternating_values</span><span class="p">,</span> <span class="n">mask_start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([False, False, False, False], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_mask</span><span class="o">=</span><span class="n">take_alternating_values</span><span class="p">,</span> <span class="n">mask_start</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([False, False,  True,  True], dtype=bool)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="meta">
<h3>meta<a class="headerlink" href="#meta" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">handle_meta</span></code> parameter for the arithmetic operations implements what the
resulting meta will be. The options are the same as for the <code class="docutils literal"><span class="pre">mask</span></code>:</p>
<ul>
<li><p class="first">If <code class="docutils literal"><span class="pre">None</span></code> the resulting <code class="docutils literal"><span class="pre">meta</span></code> will be an empty <a class="reference external" href="http://docs.python.org/3/library/collections.html#collections.OrderedDict" title="(in Python v3.5)"><code class="xref py py-obj docutils literal"><span class="pre">collections.OrderedDict</span></code></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="s">&#39;sun&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="s">&#39;moon&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">meta</span>
<span class="go">OrderedDict()</span>
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">meta</span></code> this is the default so you don&#8217;t need to pass it in this case:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">)</span><span class="o">.</span><span class="n">meta</span>
<span class="go">OrderedDict()</span>
</pre></div>
</div>
</li>
<li><p class="first">If <code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;ff&quot;</span></code> the resulting meta will be the meta of the
first operand or if that contains no keys the meta of the second operand is
taken.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="s">&#39;sun&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="s">&#39;moon&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="s">&#39;ff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">meta</span>
<span class="go">{&#39;object&#39;: &#39;sun&#39;}</span>
</pre></div>
</div>
</li>
<li><p class="first">If it&#8217;s a <code class="docutils literal"><span class="pre">callable</span></code> it must take at least two arguments. Both <code class="docutils literal"><span class="pre">meta</span></code>
attributes will be passed to this function (even if one or both of them are
empty) and the callable evaluates the result&#8217;s meta. For example just a
function that merges these two:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># It&#39;s expected with arithmetics that the result is not a reference,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># so we need to copy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">combine_meta</span><span class="p">(</span><span class="n">meta1</span><span class="p">,</span> <span class="n">meta2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">meta1</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">meta2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">meta2</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">meta1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">meta_final</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">meta1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">meta_final</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">meta2</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">meta_final</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;time&#39;</span><span class="p">:</span> <span class="s">&#39;today&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="s">&#39;moon&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">handle_meta</span><span class="o">=</span><span class="n">combine_meta</span><span class="p">)</span><span class="o">.</span><span class="n">meta</span> 
<span class="go">{&#39;object&#39;: &#39;moon&#39;, &#39;time&#39;: &#39;today&#39;}</span>
</pre></div>
</div>
<p>Here again additional arguments for the function can be passed in using
the prefix <code class="docutils literal"><span class="pre">meta_</span></code> (which will be stripped away before passing it to this)
function. See the description for the mask-attribute for further details.</p>
</li>
</ul>
</div>
<div class="section" id="wcs">
<h3>wcs<a class="headerlink" href="#wcs" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">compare_wcs</span></code> argument will determine what the result&#8217;s <code class="docutils literal"><span class="pre">wcs</span></code> will be
or if the operation should be forbidden. The possible values are identical to
<code class="docutils literal"><span class="pre">mask</span></code> and <code class="docutils literal"><span class="pre">meta</span></code>:</p>
<ul>
<li><p class="first">If <code class="docutils literal"><span class="pre">None</span></code> the resulting <code class="docutils literal"><span class="pre">wcs</span></code> will be an empty <code class="docutils literal"><span class="pre">None</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">compare_wcs</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">wcs</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
</li>
<li><p class="first">If <code class="docutils literal"><span class="pre">&quot;first_found&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;ff&quot;</span></code> the resulting wcs will be the wcs of the
first operand or if that is None the meta of the second operand is
taken.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">compare_wcs</span><span class="o">=</span><span class="s">&#39;ff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">wcs</span>
<span class="go">1</span>
</pre></div>
</div>
</li>
<li><p class="first">If it&#8217;s a <code class="docutils literal"><span class="pre">callable</span></code> it must take at least two arguments. Both <code class="docutils literal"><span class="pre">wcs</span></code>
attributes will be passed to this function (even if one or both of them are
None) and the callable should return <code class="docutils literal"><span class="pre">True</span></code> if these wcs are identical
(enough) to allow the arithmetic operation or <code class="docutils literal"><span class="pre">False</span></code> if the arithmetic
operation should be aborted with a <code class="docutils literal"><span class="pre">ValueError</span></code>. If <code class="docutils literal"><span class="pre">True</span></code> the <code class="docutils literal"><span class="pre">wcs</span></code>
are identical and the first one is used for the result:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">compare_wcs_scalar</span><span class="p">(</span><span class="n">wcs1</span><span class="p">,</span> <span class="n">wcs2</span><span class="p">,</span> <span class="n">allowed_deviation</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">wcs1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">wcs2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">True</span>  <span class="c"># both have no WCS so they are identical</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">wcs1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">wcs2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">False</span>  <span class="c"># one has WCS, the other doesn&#39;t not possible</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">wcs1</span> <span class="o">-</span> <span class="n">wcs2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">allowed_deviation</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">compare_wcs</span><span class="o">=</span><span class="n">compare_wcs_scalar</span><span class="p">)</span><span class="o">.</span><span class="n">wcs</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Additional arguments can be passed in prefixing them with <code class="docutils literal"><span class="pre">wcs_</span></code> (this
prefix will be stripped away before passing it to the function):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">compare_wcs</span><span class="o">=</span><span class="n">compare_wcs_scalar</span><span class="p">,</span> <span class="n">wcs_allowed_deviation</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">wcs</span>
<span class="go">1</span>
</pre></div>
</div>
<p>If one is using <a class="reference internal" href="../../api/astropy.wcs.WCS.html#astropy.wcs.WCS" title="astropy.wcs.WCS"><code class="xref py py-obj docutils literal"><span class="pre">WCS</span></code></a> objects a very handy function to use might
be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">wcs_compare</span><span class="p">(</span><span class="n">wcs1</span><span class="p">,</span> <span class="n">wcs2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">wcs1</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">wcs2</span><span class="o">.</span><span class="n">wcs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>see <a class="reference internal" href="../../api/astropy.wcs.Wcsprm.html#astropy.wcs.Wcsprm.compare" title="astropy.wcs.Wcsprm.compare"><code class="xref py py-meth docutils literal"><span class="pre">astropy.wcs.Wcsprm.compare()</span></code></a> for the arguments this comparison
allows.</p>
</li>
</ul>
</div>
<div class="section" id="uncertainty">
<h3>uncertainty<a class="headerlink" href="#uncertainty" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">propagate_uncertainties</span></code> argument can be used to turn the propagation
of uncertainties on or off.</p>
<ul>
<li><p class="first">If <code class="docutils literal"><span class="pre">None</span></code> the result will have no uncertainty:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
</li>
<li><p class="first">If <code class="docutils literal"><span class="pre">False</span></code> the result will have the first found uncertainty.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Setting <code class="docutils literal"><span class="pre">propagate_uncertainties=False</span></code> is not generally not
recommended.</p>
</div>
</li>
<li><p class="first">If <code class="docutils literal"><span class="pre">True</span></code> both uncertainties must be <code class="docutils literal"><span class="pre">NDUncertainty</span></code> subclasses that
implement propagation. This is possible for
<a class="reference internal" href="../../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([ 14.14213562])</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="uncertainty-with-correlation">
<h3>uncertainty with correlation<a class="headerlink" href="#uncertainty-with-correlation" title="Permalink to this headline">¶</a></h3>
<p>If <code class="docutils literal"><span class="pre">propagate_uncertainties</span></code> is <code class="docutils literal"><span class="pre">True</span></code> you can give also an argument
for <code class="docutils literal"><span class="pre">uncertainty_correlation</span></code>. <a class="reference internal" href="../../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a> cannot
keep track of it&#8217;s correlations by itself but it can evaluate the correct
resulting uncertainty if the correct <code class="docutils literal"><span class="pre">correlation</span></code> is given.</p>
<p>The default (<code class="docutils literal"><span class="pre">0</span></code>) represents uncorrelated while <code class="docutils literal"><span class="pre">1</span></code> means correlated and
<code class="docutils literal"><span class="pre">-1</span></code> anti-correlated. If given a <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.11)"><code class="xref py py-obj docutils literal"><span class="pre">numpy.ndarray</span></code></a> it should represent the
element-wise correlation coefficient.</p>
<p>For example without correlation subtracting a <a class="reference internal" href="../../api/astropy.nddata.NDDataRef.html#astropy.nddata.NDDataRef" title="astropy.nddata.NDDataRef"><code class="xref py py-obj docutils literal"><span class="pre">NDDataRef</span></code></a>
instance from itself results in a non-zero uncertainty:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd1</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([ 14.14213562])</span>
</pre></div>
</div>
<p>Given a correlation of <code class="docutils literal"><span class="pre">1</span></code> because they clearly correlate gives the
correct uncertainty of <code class="docutils literal"><span class="pre">0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd1</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">uncertainty_correlation</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([ 0.])</span>
</pre></div>
</div>
<p>which would be consistent with the equivalent operation <code class="docutils literal"><span class="pre">ndd1</span> <span class="pre">*</span> <span class="pre">0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([0])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The user needs to calculate or know the appropriate value or array manually
and pass it to <code class="docutils literal"><span class="pre">uncertainty_correlation</span></code>. The implementation follows
general first order error propagation formulas, see for example:
<a class="reference external" href="https://en.wikipedia.org/wiki/Propagation_of_uncertainty#Example_formulas">Wikipedia</a>.</p>
</div>
<p>You can also give element-wise correlations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span><span class="n">uncertainty_correlation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([ 3.        ,  2.64575131,  2.23606798,  1.        ])</span>
</pre></div>
</div>
<p>The correlation <code class="docutils literal"><span class="pre">np.array([1,</span> <span class="pre">0.5,</span> <span class="pre">0,</span> <span class="pre">-1])</span></code> would indicate that the first
element is fully correlated, the second element partially correlates while
element 3 is uncorrelated and 4 is anti-correlated.</p>
</div>
<div class="section" id="uncertainty-with-unit">
<h3>uncertainty with unit<a class="headerlink" href="#uncertainty-with-unit" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="../../api/astropy.nddata.StdDevUncertainty.html#astropy.nddata.StdDevUncertainty" title="astropy.nddata.StdDevUncertainty"><code class="xref py py-obj docutils literal"><span class="pre">StdDevUncertainty</span></code></a> implements correct error propagation even
if the unit of the data differs from the unit of the uncertainty:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;cm&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd2</span> <span class="o">=</span> <span class="n">NDDataRef</span><span class="p">([</span><span class="mi">20</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">([</span><span class="mi">10</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ndd1</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ndd2</span><span class="p">,</span> <span class="n">propagate_uncertainties</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">uncertainty</span>
<span class="go">StdDevUncertainty([ 10.00049999])</span>
</pre></div>
</div>
<p>but it needs to be convertible to the unit for the data.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">NDData Arithmetic</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#using-basic-arithmetic-methods">Using basic arithmetic methods</a></li>
<li><a class="reference internal" href="#using-arithmetic-classmethods">Using arithmetic classmethods</a><ul>
<li><a class="reference internal" href="#possible-operands">Possible operands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-options">Advanced options</a><ul>
<li><a class="reference internal" href="#data-unit">data, unit</a></li>
<li><a class="reference internal" href="#mask">mask</a></li>
<li><a class="reference internal" href="#meta">meta</a></li>
<li><a class="reference internal" href="#wcs">wcs</a></li>
<li><a class="reference internal" href="#uncertainty">uncertainty</a></li>
<li><a class="reference internal" href="#uncertainty-with-correlation">uncertainty with correlation</a></li>
<li><a class="reference internal" href="#uncertainty-with-unit">uncertainty with unit</a></li>
</ul>
</li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/nddata/mixins/ndarithmetic.rst">Edit This Page on Github</a> &nbsp;
    <a href="../../_sources/nddata/mixins/ndarithmetic.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 10 Jun 2016. <br/>
  </p>
</footer>
  </body>
</html>