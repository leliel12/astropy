<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Efficient Model Rendering with Bounding Boxes &mdash; Astropy v1.2.dev14994</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.dev14994',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev14994" href="../index.html" />
    <link rel="up" title="Models and Fitting (astropy.modeling)" href="index.html" />
    <link rel="next" title="Algorithms" href="algorithms.html" />
    <link rel="prev" title="Defining New Model Classes" href="new.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="algorithms.html" title="Algorithms">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="new.html" title="Defining New Model Classes">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v1.2.dev14994</a>
	 &raquo;
      </li>
      <li><a href="index.html" accesskey="U">Models and Fitting (<code class="docutils literal"><span class="pre">astropy.modeling</span></code>)</a> &raquo;</li>
      
      <li>Efficient Model Rendering with Bounding Boxes</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="efficient-model-rendering-with-bounding-boxes">
<span id="bounding-boxes"></span><h1>Efficient Model Rendering with Bounding Boxes<a class="headerlink" href="#efficient-model-rendering-with-bounding-boxes" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 1.1.</span></p>
</div>
<p>All <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model" title="astropy.modeling.Model"><code class="xref py py-obj docutils literal"><span class="pre">Model</span></code></a> subclasses have a
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal"><span class="pre">bounding_box</span></code></a> attribute that
can be used to set the limits over which the model is significant. This greatly
improves the efficiency of evaluation when the input range is much larger than
the characteristic width of the model itself. For example, to create a sky model
image from a large survey catalog, each source should only be evaluated over the
pixels to which it contributes a significant amount of flux. This task can
otherwise be computationally prohibitive on an average CPU.</p>
<p>The <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal"><span class="pre">Model.render</span></code></a> method can be used to
evaluate a model on an output array, or input coordinate arrays, limiting the
evaluation to the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal"><span class="pre">bounding_box</span></code></a> region if
it is set. This function will also produce postage stamp images of the model if
no other input array is passed. To instead extract postage stamps from the data
array itself, see <a class="reference internal" href="../nddata/utils.html#cutout-images"><span>2D Cutout Images</span></a>.</p>
<div class="section" id="using-the-bounding-box">
<h2>Using the Bounding Box<a class="headerlink" href="#using-the-bounding-box" title="Permalink to this headline">¶</a></h2>
<p>For basic usage, see <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal"><span class="pre">Model.bounding_box</span></code></a>.  By default no
<a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal"><span class="pre">bounding_box</span></code></a> is set, except on model subclasses where
a <code class="docutils literal"><span class="pre">bounding_box</span></code> property or method is explicity defined. The default is then
the minimum rectangular region symmetric about the position that fully contains
the model. If the model does not have a finite extent, the containment criteria
are noted in the documentation. For example, see <code class="docutils literal"><span class="pre">Gaussian2D.bounding_box</span></code>.</p>
<p><a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.bounding_box" title="astropy.modeling.Model.bounding_box"><code class="xref py py-obj docutils literal"><span class="pre">Model.bounding_box</span></code></a> can be set by the
user to any callable. This is particularly useful for fitting models created
with <a class="reference internal" href="../api/astropy.modeling.custom_model.html#astropy.modeling.custom_model" title="astropy.modeling.custom_model"><code class="xref py py-obj docutils literal"><span class="pre">custom_model</span></code></a> or as a compound model:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">custom_model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">ellipsoid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">rsq</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="n">z</span> <span class="o">-</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="gp">... </span>    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">rsq</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">amp</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">val</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Ellipsoid3D</span><span class="p">(</span><span class="n">custom_model</span><span class="p">(</span><span class="n">ellipsoid</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="c"># A 3D ellipsoid model</span>
<span class="gp">... </span>    <span class="nd">@property</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">),</span>
<span class="gp">... </span>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Ellipsoid3D</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span>
<span class="go">((-4.0, 4.0), (-3.0, 3.0), (-2.0, 2.0))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Currently when creating a new compound model by combining multiple
models, the bounding boxes of the components (if any) are not currently
combined.  So bounding boxes for compound models must be assigned
explicitly.  A future release will determine the appropriate bounding box
for a compound model where possible.</p>
</div>
</div>
<div class="section" id="efficient-evaluation-with-model-render">
<h2>Efficient evaluation with <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-obj docutils literal"><span class="pre">Model.render()</span></code></a><a class="headerlink" href="#efficient-evaluation-with-model-render" title="Permalink to this headline">¶</a></h2>
<p>When a model is evaluated over a range much larger than the model itself, it
may be prudent to use the <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal"><span class="pre">Model.render</span></code></a>
method if efficiency is a concern. The <a class="reference internal" href="../api/astropy.modeling.Model.html#astropy.modeling.Model.render" title="astropy.modeling.Model.render"><code class="xref py py-func docutils literal"><span class="pre">render</span></code></a> method can be used to evaluate the model on an
array of the same dimensions.  <code class="docutils literal"><span class="pre">model.render()</span></code> can be called with no
arguments to return a &#8220;postage stamp&#8221; of the bounding box region.</p>
<p>In this example, we generate a 300x400 pixel image of 100 2D Gaussian sources.
For comparison, the models are evaluated both with and without using bounding
boxes. By using bounding boxes, the evaluation speed increases by approximately
a factor of 10 with negligible loss of information.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>

<span class="n">imshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>

<span class="c"># Generate random source model list</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">nsrc</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">model_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">x_mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imshape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">y_mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imshape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
         <span class="n">x_stddev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">y_stddev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
         <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsrc</span><span class="p">)]</span>

<span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Gaussian2D</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">model_params</span><span class="p">]</span>

<span class="c"># Render models to image using bounding boxes</span>
<span class="n">bb_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>
<span class="n">t_bb</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">bb_image</span><span class="p">)</span>
<span class="n">t_bb</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_bb</span>

<span class="c"># Render models to image using full evaluation</span>
<span class="n">full_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">imshape</span><span class="p">)</span>
<span class="n">t_full</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">model</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">full_image</span><span class="p">)</span>
<span class="n">t_full</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_full</span>

<span class="n">flux</span> <span class="o">=</span> <span class="n">full_image</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">full_image</span> <span class="o">-</span> <span class="n">bb_image</span><span class="p">)</span>
<span class="n">max_err</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c"># Plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span> <span class="n">right</span><span class="o">=.</span><span class="mi">97</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=.</span><span class="mo">03</span><span class="p">,</span> <span class="n">top</span><span class="o">=.</span><span class="mi">97</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

<span class="c"># Full model image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">full_image</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Full Models</span><span class="se">\n</span><span class="s">Timing: {:.2f} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_full</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>

<span class="c"># Bounded model image with boxes overplotted</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bb_image</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">model_list</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span>  <span class="c"># Reset bounding_box to its default</span>
    <span class="n">dy</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">x_mean</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">y_mean</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Bounded Models</span><span class="se">\n</span><span class="s">Timing: {:.2f} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_bb</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>

<span class="c"># Difference image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">max_err</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_err</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.1e</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Difference Image</span><span class="se">\n</span><span class="s">Total Flux Err = {:.0e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="p">((</span><span class="n">flux</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bb_image</span><span class="p">))</span> <span class="o">/</span> <span class="n">flux</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../modeling/bounding-boxes-1.py">Source code</a>)</p>
<div class="figure" id="id2">
<img alt="../_images/bounding-boxes-1_00.png" src="../_images/bounding-boxes-1_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../modeling/bounding-boxes-1_00.png">png</a>, <a class="reference external" href="../modeling/bounding-boxes-1_00.hires.png">hires.png</a>, <a class="reference external" href="../modeling/bounding-boxes-1_00.pdf">pdf</a>)</span></p>
</div>
<div class="figure" id="id3">
<img alt="../_images/bounding-boxes-1_01.png" src="../_images/bounding-boxes-1_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../modeling/bounding-boxes-1_01.png">png</a>, <a class="reference external" href="../modeling/bounding-boxes-1_01.hires.png">hires.png</a>, <a class="reference external" href="../modeling/bounding-boxes-1_01.pdf">pdf</a>)</span></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Efficient Model Rendering with Bounding Boxes</a><ul>
<li><a class="reference internal" href="#using-the-bounding-box">Using the Bounding Box</a></li>
<li><a class="reference internal" href="#efficient-evaluation-with-model-render">Efficient evaluation with <code class="docutils literal"><span class="pre">Model.render()</span></code></a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/modeling/bounding-boxes.rst">Edit This Page on Github</a> &nbsp;
    <a href="../_sources/modeling/bounding-boxes.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 11 May 2016. <br/>
  </p>
</footer>
  </body>
</html>