<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Fast ASCII I/O &mdash; Astropy v1.2.dev15003</title>
    
    <link rel="stylesheet" href="../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.dev15003',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev15003" href="../../index.html" />
    <link rel="up" title="ASCII Tables (astropy.io.ascii)" href="index.html" />
    <link rel="next" title="Base class elements" href="base_classes.html" />
    <link rel="prev" title="Fixed-width Gallery" href="fixed_width_gallery.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="base_classes.html" title="Base class elements">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="fixed_width_gallery.html" title="Fixed-width Gallery">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../../index.html">Astropy v1.2.dev15003</a>
	 &raquo;
      </li>
      <li><a href="index.html" accesskey="U">ASCII Tables (<code class="docutils literal"><span class="pre">astropy.io.ascii</span></code>)</a> &raquo;</li>
      
      <li>Fast ASCII I/O</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fast-ascii-i-o">
<span id="fast-ascii-io"></span><h1>Fast ASCII I/O<a class="headerlink" href="#fast-ascii-i-o" title="Permalink to this headline">¶</a></h1>
<p>While <a class="reference internal" href="index.html#module-astropy.io.ascii" title="astropy.io.ascii"><code class="xref py py-mod docutils literal"><span class="pre">astropy.io.ascii</span></code></a> was designed with flexibility and extensibility
in mind, there is also a less flexible but significantly faster Cython/C engine for
reading and writing ASCII files. By default, <a class="reference internal" href="../../api/astropy.io.ascii.read.html#astropy.io.ascii.read" title="astropy.io.ascii.read"><code class="xref py py-func docutils literal"><span class="pre">read()</span></code></a> and <a class="reference internal" href="../../api/astropy.io.ascii.write.html#astropy.io.ascii.write" title="astropy.io.ascii.write"><code class="xref py py-func docutils literal"><span class="pre">write()</span></code></a> will attempt to
use this engine when dealing with compatible formats. The following formats
are currently compatible with the fast engine:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">basic</span></code></li>
<li><code class="docutils literal"><span class="pre">commented_header</span></code></li>
<li><code class="docutils literal"><span class="pre">csv</span></code></li>
<li><code class="docutils literal"><span class="pre">no_header</span></code></li>
<li><code class="docutils literal"><span class="pre">rdb</span></code></li>
<li><code class="docutils literal"><span class="pre">tab</span></code></li>
</ul>
</div></blockquote>
<p>The fast engine can also be enabled through the format parameter by prefixing
a compatible format with &#8220;fast&#8221; and then an underscore. In this case, <a class="reference internal" href="../../api/astropy.io.ascii.read.html#astropy.io.ascii.read" title="astropy.io.ascii.read"><code class="xref py py-func docutils literal"><span class="pre">read()</span></code></a>
will not fall back on an ordinary reader if fast reading fails.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;file.csv&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;fast_csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;output.csv&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;ascii.fast_csv&#39;</span><span class="p">)</span>  
</pre></div>
</div>
<p>To disable the fast engine, specify <code class="docutils literal"><span class="pre">fast_reader=False</span></code> or
<code class="docutils literal"><span class="pre">fast_writer=False</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;file.csv&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;file.csv&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="n">fast_writer</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> 
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Guessing and Fast reading</p>
<p>By default <a class="reference internal" href="../../api/astropy.io.ascii.read.html#astropy.io.ascii.read" title="astropy.io.ascii.read"><code class="xref py py-func docutils literal"><span class="pre">read()</span></code></a> will try to guess the format of in the input data by successively
trying different formats until one succeeds ([reference the guessing section]).
For the default <code class="docutils literal"><span class="pre">'ascii'</span></code> format this means that a number of pure Python readers
with no fast implementation will be tried before getting to the fast readers.</p>
<p class="last"><strong>For optimum performance</strong>, turn off guessing entirely (<code class="docutils literal"><span class="pre">guess=False</span></code>) or
narrow down the format options as much as possible by specifying the format
(e.g. <code class="docutils literal"><span class="pre">format='csv'</span></code>) and/or other options such as the delimiter.</p>
</div>
<div class="section" id="reading">
<h2>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h2>
<p>Since the fast engine is not part of the ordinary <a class="reference internal" href="index.html#module-astropy.io.ascii" title="astropy.io.ascii"><code class="xref py py-mod docutils literal"><span class="pre">astropy.io.ascii</span></code></a>
infrastructure, fast readers raise an error when passed certain
parameters which are not implemented in the fast reader
infrastructure. In this case <a class="reference internal" href="../../api/astropy.io.ascii.read.html#astropy.io.ascii.read" title="astropy.io.ascii.read"><code class="xref py py-func docutils literal"><span class="pre">read()</span></code></a> will fall back on the ordinary reader.
These parameters are:</p>
<blockquote>
<div><ul class="simple">
<li>Negative <code class="docutils literal"><span class="pre">header_start</span></code> (except for commented-header format)</li>
<li>Negative <code class="docutils literal"><span class="pre">data_start</span></code></li>
<li><code class="docutils literal"><span class="pre">data_start=None</span></code></li>
<li><code class="docutils literal"><span class="pre">comment</span></code> string not of length 1</li>
<li><code class="docutils literal"><span class="pre">delimiter</span></code> string not of length 1</li>
<li><code class="docutils literal"><span class="pre">quotechar</span></code> string not of length 1</li>
<li><code class="docutils literal"><span class="pre">converters</span></code></li>
<li><code class="docutils literal"><span class="pre">Outputter</span></code></li>
<li><code class="docutils literal"><span class="pre">Inputter</span></code></li>
<li><code class="docutils literal"><span class="pre">data_Splitter</span></code></li>
<li><code class="docutils literal"><span class="pre">header_Splitter</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="parallel-and-fast-conversion-options">
<h2>Parallel and fast conversion options<a class="headerlink" href="#parallel-and-fast-conversion-options" title="Permalink to this headline">¶</a></h2>
<p>In addition to <code class="docutils literal"><span class="pre">True</span></code> and <code class="docutils literal"><span class="pre">False</span></code>, the parameter <code class="docutils literal"><span class="pre">fast_reader</span></code> can also
be a dict specifying one or both of two additional parameters, <code class="docutils literal"><span class="pre">parallel</span></code> and
<code class="docutils literal"><span class="pre">use_fast_converter</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;data.txt&#39;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">fast_reader</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;parallel&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;use_fast_converter&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span> 
</pre></div>
</div>
<p>These options allow for even faster table reading when enabled, but both are
disabled by default because they come with some caveats.</p>
<p>The <code class="docutils literal"><span class="pre">parallel</span></code> parameter can be used to enable multiprocessing via
the <code class="docutils literal"><span class="pre">multiprocessing</span></code> module, and can either be set to a number (the number
of processes to use) or <code class="docutils literal"><span class="pre">True</span></code>, in which case the number of processes will be
<code class="docutils literal"><span class="pre">multiprocessing.cpu_count()</span></code>.   Note that this can cause issues within the
IPython Notebook and so enabling multiprocessing in this context is discouraged.</p>
<p>Setting <code class="docutils literal"><span class="pre">use_fast_converter</span></code> to be <code class="docutils literal"><span class="pre">True</span></code> enables a faster but
slightly imprecise conversion method for floating-point values, as described below.</p>
</div>
<div class="section" id="writing">
<h2>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h2>
<p>The fast engine supports the same functionality as the ordinary writing engine
and is generally about 2 to 4 times faster than the ordinary engine. An IPython
notebook testing the relative performance of the fast writer against the
ordinary writing system and the data analysis library <a class="reference external" href="http://pandas.pydata.org/">Pandas</a> is available <a class="reference external" href="http://nbviewer.ipython.org/github/astropy/astropy-notebooks/blob/master/io/ascii/ascii_write_bench.ipynb">here</a>.
The speed advantage of the faster engine is greatest for integer data and least
for floating-point data; the fast engine is around 3.6 times faster for a
sample file including a mixture of floating-point, integer, and text data.
Also note that stripping string values slows down the writing process, so
specifying <code class="docutils literal"><span class="pre">strip_whitespace=False</span></code> can improve performance.</p>
</div>
<div class="section" id="fast-converter">
<h2>Fast converter<a class="headerlink" href="#fast-converter" title="Permalink to this headline">¶</a></h2>
<p>Input floating-point values should ideally be converted to the
nearest possible floating-point approximation; that is, the conversion
should be correct within half of the distance between the two closest
representable values, or 0.5 <a class="reference external" href="http://en.wikipedia.org/wiki/Unit_in_the_last_place">ULP</a>. The ordinary readers,
as well as the default fast reader, are guaranteed to convert floating-point
values within 0.5 ULP, but there is also a faster and less accurate
conversion method accessible via <code class="docutils literal"><span class="pre">use_fast_converter</span></code>. If the input
data has less than about 15 significant figures, or if accuracy is relatively
unimportant, this converter might be the best option in
performance-critical scenarios.</p>
<p><a class="reference external" href="http://nbviewer.ipython.org/github/astropy/astropy-notebooks/blob/master/io/ascii/conversion_profile.ipynb">Here</a>
is an IPython notebook analyzing the error of the fast converter, both in
decimal values and in ULP. For values with a reasonably small number of
significant figures, the fast converter is guaranteed to produce an optimal
conversion (within 0.5 ULP). Once the number of significant figures exceeds
the precision of 64-bit floating-point values, the fast converter is no
longer guaranteed to be within 0.5 ULP, but about 60% of values end up
within 0.5 ULP and about 90% within 1.0 ULP. Another notebook analyzing
the fast converter&#8217;s behavior with extreme values (such as subnormals
and values out of the range of floats) is available <a class="reference external" href="http://nbviewer.ipython.org/github/astropy/astropy-notebooks/blob/master/io/ascii/test_converter.ipynb">here</a>.</p>
</div>
<div class="section" id="speed-gains">
<h2>Speed gains<a class="headerlink" href="#speed-gains" title="Permalink to this headline">¶</a></h2>
<p>The fast ASCII engine was designed based on the general parsing strategy
used in the <a class="reference external" href="http://pandas.pydata.org/">Pandas</a> data analysis library, so
its performance is generally comparable (although slightly slower by
default) to the Pandas <code class="docutils literal"><span class="pre">read_csv</span></code> method.
<a class="reference external" href="http://nbviewer.ipython.org/github/astropy/astropy-notebooks/blob/master/io/ascii/ascii_read_bench.ipynb">Here</a>
is an IPython notebook comparing the performance of the ordinary
<a class="reference internal" href="index.html#module-astropy.io.ascii" title="astropy.io.ascii"><code class="xref py py-mod docutils literal"><span class="pre">astropy.io.ascii</span></code></a> reader, the fast reader, the fast reader with the
fast converter enabled, numpy&#8217;s <code class="docutils literal"><span class="pre">genfromtxt</span></code>, and Pandas&#8217; <code class="docutils literal"><span class="pre">read_csv</span></code>
for different kinds of table data in a basic space-delimited file.</p>
<p>In summary, <code class="docutils literal"><span class="pre">genfromtxt</span></code> and the ordinary <a class="reference internal" href="index.html#module-astropy.io.ascii" title="astropy.io.ascii"><code class="xref py py-mod docutils literal"><span class="pre">astropy.io.ascii</span></code></a> reader
are very similar in terms of speed, while <code class="docutils literal"><span class="pre">read_csv</span></code> is slightly faster
than the fast engine for integer and floating-point data; for pure
floating-point data, enabling the fast converter yields a speedup of about
50%. Also note that Pandas uses the exact same method as the fast
converter in AstroPy when converting floating-point data.</p>
<p>The difference in performance between the fast engine and Pandas for
text data depends on the extent to which data values are repeated, as
Pandas is almost twice as fast as the fast engine when every value is
identical and the reverse is true when values are randomized. This is
because the fast engine uses fixed-size numpy string arrays for
text data, while Pandas uses variable-size object arrays and uses an
underlying set to avoid copying repeated values.</p>
<p>Overall, the fast engine tends to be around 4 or 5 times faster than
the ordinary ASCII engine. If the input data is very large (generally
about 100,000 rows or greater), and particularly if the data doesn&#8217;t
contain primarily integer data or repeated string values, specifying
<code class="docutils literal"><span class="pre">parallel</span></code> as <code class="docutils literal"><span class="pre">True</span></code> can yield further performance gains. Although
IPython doesn&#8217;t work well with <code class="docutils literal"><span class="pre">multiprocessing</span></code>, there is a
<a class="reference external" href="https://github.com/amras1/ascii-profiling/blob/master/parallel.py">script</a>
available for testing the performance of the fast engine in parallel,
and a sample result may be viewed <a class="reference external" href="http://amras1.github.io/ascii-profiling/">here</a>. This profile uses the
fast converter for both the serial and parallel AstroPy
readers.</p>
<p>Another point worth noting is that the fast engine uses memory mapping
if a filename is supplied as input. If you want to avoid this for whatever
reason, supply an open file object instead. However, this will generally
be less efficient from both a time and a memory perspective, as the entire
file input will have to be read at once.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Fast ASCII I/O</a><ul>
<li><a class="reference internal" href="#reading">Reading</a></li>
<li><a class="reference internal" href="#parallel-and-fast-conversion-options">Parallel and fast conversion options</a></li>
<li><a class="reference internal" href="#writing">Writing</a></li>
<li><a class="reference internal" href="#fast-converter">Fast converter</a></li>
<li><a class="reference internal" href="#speed-gains">Speed gains</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/io/ascii/fast_ascii_io.rst">Edit This Page on Github</a> &nbsp;
    <a href="../../_sources/io/ascii/fast_ascii_io.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 12 May 2016. <br/>
  </p>
</footer>
  </body>
</html>