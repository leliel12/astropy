<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>astropy.io.fits.hdu.hdulist &mdash; Astropy v1.2.dev14996</title>
    
    <link rel="stylesheet" href="../../../../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '1.2.dev14996',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../../../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev14996" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../../../../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../../../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../../../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../../../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../../../../index.html">Astropy v1.2.dev14996</a>
	 &raquo;
      </li>
      <li><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for astropy.io.fits.hdu.hdulist</h1><div class="highlight"><pre>
<span class="c"># Licensed under a 3-clause BSD style license - see PYFITS.rst</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">compressed</span>
<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">_BaseHDU</span><span class="p">,</span> <span class="n">_ValidHDU</span><span class="p">,</span> <span class="n">_NonstandardHDU</span><span class="p">,</span> <span class="n">ExtensionHDU</span>
<span class="kn">from</span> <span class="nn">.groups</span> <span class="kn">import</span> <span class="n">GroupsHDU</span>
<span class="kn">from</span> <span class="nn">.image</span> <span class="kn">import</span> <span class="n">PrimaryHDU</span><span class="p">,</span> <span class="n">ImageHDU</span>
<span class="kn">from</span> <span class="nn">..file</span> <span class="kn">import</span> <span class="n">_File</span>
<span class="kn">from</span> <span class="nn">..header</span> <span class="kn">import</span> <span class="n">_pad_length</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_is_int</span><span class="p">,</span> <span class="n">_tmp_name</span><span class="p">,</span> <span class="n">fileobj_closed</span><span class="p">,</span> <span class="n">ignore_sigint</span><span class="p">,</span>
                    <span class="n">_get_array_mmap</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..verify</span> <span class="kn">import</span> <span class="n">_Verify</span><span class="p">,</span> <span class="n">_ErrList</span><span class="p">,</span> <span class="n">VerifyError</span><span class="p">,</span> <span class="n">VerifyWarning</span>
<span class="kn">from</span> <span class="nn">....extern.six</span> <span class="kn">import</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">....utils</span> <span class="kn">import</span> <span class="n">indent</span>
<span class="kn">from</span> <span class="nn">....utils.exceptions</span> <span class="kn">import</span> <span class="n">AstropyUserWarning</span><span class="p">,</span> <span class="n">AstropyDeprecationWarning</span>


<span class="k">def</span> <span class="nf">fitsopen</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;readonly&#39;</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">save_backup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory function to open a FITS file and return an `HDUList` object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : file path, file object, file-like object or pathlib.Path object</span>
<span class="sd">        File to be opened.</span>

<span class="sd">    mode : str, optional</span>
<span class="sd">        Open mode, &#39;readonly&#39; (default), &#39;update&#39;, &#39;append&#39;, &#39;denywrite&#39;, or</span>
<span class="sd">        &#39;ostream&#39;.</span>

<span class="sd">        If ``name`` is a file object that is already opened, ``mode`` must</span>
<span class="sd">        match the mode the file was opened with, readonly (rb), update (rb+),</span>
<span class="sd">        append (ab+), ostream (w), denywrite (rb)).</span>

<span class="sd">    memmap : bool, optional</span>
<span class="sd">        Is memory mapping to be used?</span>

<span class="sd">    save_backup : bool, optional</span>
<span class="sd">        If the file was opened in update or append mode, this ensures that a</span>
<span class="sd">        backup of the original file is saved before any changes are flushed.</span>
<span class="sd">        The backup has the same name as the original file with &quot;.bak&quot; appended.</span>
<span class="sd">        If &quot;file.bak&quot; already exists then &quot;file.bak.1&quot; is used, and so on.</span>

<span class="sd">    cache : bool, optional</span>
<span class="sd">        If the file name is a URL, `~astropy.utils.data.download_file` is used</span>
<span class="sd">        to open the file.  This specifies whether or not to save the file</span>
<span class="sd">        locally in Astropy&#39;s download cache (default: `True`).</span>

<span class="sd">    kwargs : dict, optional</span>
<span class="sd">        additional optional keyword arguments, possible values are:</span>

<span class="sd">        - **uint** : bool</span>

<span class="sd">            Interpret signed integer data where ``BZERO`` is the</span>
<span class="sd">            central value and ``BSCALE == 1`` as unsigned integer</span>
<span class="sd">            data.  For example, ``int16`` data with ``BZERO = 32768``</span>
<span class="sd">            and ``BSCALE = 1`` would be treated as ``uint16`` data.</span>
<span class="sd">            This is enabled by default so that the pseudo-unsigned</span>
<span class="sd">            integer convention is assumed.</span>

<span class="sd">            Note, for backward compatibility, the kwarg **uint16** may</span>
<span class="sd">            be used instead.  The kwarg was renamed when support was</span>
<span class="sd">            added for integers of any size.</span>

<span class="sd">        - **ignore_missing_end** : bool</span>

<span class="sd">            Do not issue an exception when opening a file that is</span>
<span class="sd">            missing an ``END`` card in the last header.</span>

<span class="sd">        - **checksum** : bool, str</span>

<span class="sd">            If `True`, verifies that both ``DATASUM`` and</span>
<span class="sd">            ``CHECKSUM`` card values (when present in the HDU header)</span>
<span class="sd">            match the header and data of all HDU&#39;s in the file.  Updates to a</span>
<span class="sd">            file that already has a checksum will preserve and update the</span>
<span class="sd">            existing checksums unless this argument is given a value of</span>
<span class="sd">            &#39;remove&#39;, in which case the CHECKSUM and DATASUM values are not</span>
<span class="sd">            checked, and are removed when saving changes to the file.</span>

<span class="sd">        - **disable_image_compression** : bool</span>

<span class="sd">            If `True`, treats compressed image HDU&#39;s like normal</span>
<span class="sd">            binary table HDU&#39;s.</span>

<span class="sd">        - **do_not_scale_image_data** : bool</span>

<span class="sd">            If `True`, image data is not scaled using BSCALE/BZERO values</span>
<span class="sd">            when read.</span>

<span class="sd">        - **ignore_blank** : bool</span>

<span class="sd">            If `True`, the BLANK keyword is ignored if present.</span>

<span class="sd">        - **scale_back** : bool</span>

<span class="sd">            If `True`, when saving changes to a file that contained scaled</span>
<span class="sd">            image data, restore the data to the original type and reapply the</span>
<span class="sd">            original BSCALE/BZERO values.  This could lead to loss of accuracy</span>
<span class="sd">            if scaling back to integer values after performing floating point</span>
<span class="sd">            operations on the data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        hdulist : an `HDUList` object</span>
<span class="sd">            `HDUList` containing all of the header data units in the</span>
<span class="sd">            file.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">conf</span>

    <span class="k">if</span> <span class="n">memmap</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># distinguish between True (kwarg explicitly set)</span>
        <span class="c"># and None (preference for memmap in config, might be ignored)</span>
        <span class="n">memmap</span> <span class="o">=</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">use_memmap</span> <span class="k">else</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">memmap</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">memmap</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;uint16&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s">&#39;uint&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;uint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;uint16&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;uint16&#39;</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s">&#39;The uint16 keyword argument is deprecated since v1.1.0.  Use &#39;</span>
            <span class="s">&#39;the uint argument instead.&#39;</span><span class="p">,</span> <span class="n">AstropyDeprecationWarning</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&#39;uint&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;uint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">enable_uint</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Empty filename: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">HDUList</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">memmap</span><span class="p">,</span> <span class="n">save_backup</span><span class="p">,</span> <span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="HDUList"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList">[docs]</a><span class="k">class</span> <span class="nc">HDUList</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">_Verify</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HDU list class.  This is the top-level FITS object.  When a FITS</span>
<span class="sd">    file is opened, a `HDUList` object is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdus</span><span class="o">=</span><span class="p">[],</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a `HDUList` object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdus : sequence of HDU objects or single HDU, optional</span>
<span class="sd">            The HDU object(s) to comprise the `HDUList`.  Should be</span>
<span class="sd">            instances of HDU classes like `ImageHDU` or `BinTableHDU`.</span>

<span class="sd">        file : file object, optional</span>
<span class="sd">            The opened physical file associated with the `HDUList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_backup</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">hdus</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">hdus</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># can take one HDU, as well as a list of HDU&#39;s as input</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdus</span><span class="p">,</span> <span class="n">_ValidHDU</span><span class="p">):</span>
            <span class="n">hdus</span> <span class="o">=</span> <span class="p">[</span><span class="n">hdus</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdus</span><span class="p">,</span> <span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Invalid input for HDUList.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hdus</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">_BaseHDU</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                      <span class="s">&quot;Element </span><span class="si">%d</span><span class="s"> in the HDUList input is not an HDU.&quot;</span> <span class="o">%</span> <span class="n">idx</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">hdus</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_extend</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an HDU from the `HDUList`, indexed by number or name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">hdus</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">HDUList</span><span class="p">(</span><span class="n">hdus</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns `True` if ``HDUList.index_of(item)`` succeeds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">hdu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an HDU to the `HDUList`, indexed by number or name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="p">(</span><span class="nb">slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">_is_int</span><span class="p">(</span><span class="n">_key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;An element in the HDUList must be an HDU.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hdu</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">_BaseHDU</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not an HDU.&#39;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">_BaseHDU</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not an HDU.&#39;</span> <span class="o">%</span> <span class="n">hdu</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">_key</span><span class="p">,</span> <span class="n">hdu</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&#39;Extension </span><span class="si">%s</span><span class="s"> is out of bound or not found.&#39;</span>
                             <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete an HDU from the `HDUList`, indexed by number or name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">end_index</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">__delslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a slice of HDUs from the `HDUList`, indexed by number only.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)]</span>

    <span class="c"># Support the &#39;with&#39; statement</span>
    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="HDUList.fromfile"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.fromfile">[docs]</a>    <span class="k">def</span> <span class="nf">fromfile</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">save_backup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an `HDUList` instance from a file-like object.</span>

<span class="sd">        The actual implementation of ``fitsopen()``, and generally shouldn&#39;t</span>
<span class="sd">        be used directly.  Use :func:`open` instead (and see its</span>
<span class="sd">        documentation for details of the parameters accepted by this method).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_readfrom</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="n">memmap</span><span class="p">,</span>
                             <span class="n">save_backup</span><span class="o">=</span><span class="n">save_backup</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="HDUList.fromstring"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.fromstring">[docs]</a>    <span class="k">def</span> <span class="nf">fromstring</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an `HDUList` instance from a string or other in-memory data</span>
<span class="sd">        buffer containing an entire FITS file.  Similar to</span>
<span class="sd">        :meth:`HDUList.fromfile`, but does not accept the mode or memmap</span>
<span class="sd">        arguments, as they are only relevant to reading from a file on disk.</span>

<span class="sd">        This is useful for interfacing with other libraries such as CFITSIO,</span>
<span class="sd">        and may also be useful for streaming applications.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str, buffer, memoryview, etc.</span>
<span class="sd">            A string or other memory buffer containing an entire FITS file.  It</span>
<span class="sd">            should be noted that if that memory is read-only (such as a Python</span>
<span class="sd">            string) the returned :class:`HDUList`&#39;s data portions will also be</span>
<span class="sd">            read-only.</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            Optional keyword arguments.  See</span>
<span class="sd">            :func:`astropy.io.fits.open` for details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hdul : HDUList</span>
<span class="sd">            An :class:`HDUList` object representing the in-memory FITS file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_readfrom</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HDUList.fileinfo"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.fileinfo">[docs]</a>    <span class="k">def</span> <span class="nf">fileinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary detailing information about the locations</span>
<span class="sd">        of the indexed HDU within any associated file.  The values are</span>
<span class="sd">        only valid after a read or write of the associated file with</span>
<span class="sd">        no intervening changes to the `HDUList`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of HDU for which info is to be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fileinfo : dict or None</span>

<span class="sd">            The dictionary details information about the locations of</span>
<span class="sd">            the indexed HDU within an associated file.  Returns `None`</span>
<span class="sd">            when the HDU is not associated with a file.</span>

<span class="sd">            Dictionary contents:</span>

<span class="sd">            ========== ========================================================</span>
<span class="sd">            Key        Value</span>
<span class="sd">            ========== ========================================================</span>
<span class="sd">            file       File object associated with the HDU</span>
<span class="sd">            filename   Name of associated file object</span>
<span class="sd">            filemode   Mode in which the file was opened (readonly,</span>
<span class="sd">                       update, append, denywrite, ostream)</span>
<span class="sd">            resized    Flag that when `True` indicates that the data has been</span>
<span class="sd">                       resized since the last read/write so the returned values</span>
<span class="sd">                       may not be valid.</span>
<span class="sd">            hdrLoc     Starting byte location of header in file</span>
<span class="sd">            datLoc     Starting byte location of data block in file</span>
<span class="sd">            datSpan    Data size including padding</span>
<span class="sd">            ========== ========================================================</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">fileinfo</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
                <span class="c"># OK, the HDU associated with this index is not yet</span>
                <span class="c"># tied to the file associated with the HDUList.  The only way</span>
                <span class="c"># to get the file object is to check each of the HDU&#39;s in the</span>
                <span class="c"># list until we find the one associated with the file.</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">fileinfo</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">info</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span>
                        <span class="n">fm</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;filemode&#39;</span><span class="p">]</span>
                        <span class="k">break</span>

                <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span> <span class="s">&#39;filemode&#39;</span><span class="p">:</span> <span class="n">fm</span><span class="p">,</span> <span class="s">&#39;hdrLoc&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="s">&#39;datLoc&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;datSpan&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>

            <span class="n">output</span><span class="p">[</span><span class="s">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span>
            <span class="n">output</span><span class="p">[</span><span class="s">&#39;resized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wasresized</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">output</span>
</div>
<div class="viewcode-block" id="HDUList.insert"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">hdu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert an HDU into the `HDUList` at the given ``index``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index before which to insert the new HDU.</span>

<span class="sd">        hdu : HDU object</span>
<span class="sd">            The HDU object to insert</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">_BaseHDU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not an HDU.&#39;</span> <span class="o">%</span> <span class="n">hdu</span><span class="p">)</span>

        <span class="n">num_hdus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">num_hdus</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num_hdus</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># We are inserting a new Primary HDU so we need to</span>
                <span class="c"># make the current Primary HDU into an extension HDU.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GroupsHDU</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s">&quot;The current Primary HDU is a GroupsHDU.  &quot;</span>
                        <span class="s">&quot;It can&#39;t be made into an extension HDU, &quot;</span>
                        <span class="s">&quot;so another HDU cannot be inserted before it.&quot;</span><span class="p">)</span>

                <span class="n">hdu1</span> <span class="o">=</span> <span class="n">ImageHDU</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

                <span class="c"># Insert it into position 1, then delete HDU at position 0.</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">hdu1</span><span class="p">)</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="p">(</span><span class="n">PrimaryHDU</span><span class="p">,</span> <span class="n">_NonstandardHDU</span><span class="p">)):</span>
                <span class="c"># You passed in an Extension HDU but we need a Primary HDU.</span>
                <span class="c"># If you provided an ImageHDU then we can convert it to</span>
                <span class="c"># a primary HDU and use that.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">ImageHDU</span><span class="p">):</span>
                    <span class="n">hdu</span> <span class="o">=</span> <span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># You didn&#39;t provide an ImageHDU so we create a</span>
                    <span class="c"># simple Primary HDU and append that first before</span>
                    <span class="c"># we append the new Extension HDU.</span>
                    <span class="n">phdu</span> <span class="o">=</span> <span class="n">PrimaryHDU</span><span class="p">()</span>

                    <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">phdu</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">GroupsHDU</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;A GroupsHDU must be inserted as a &#39;</span>
                                 <span class="s">&#39;Primary HDU.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">PrimaryHDU</span><span class="p">):</span>
                <span class="c"># You passed a Primary HDU but we need an Extension HDU</span>
                <span class="c"># so create an Extension HDU from the input Primary HDU.</span>
                <span class="n">hdu</span> <span class="o">=</span> <span class="n">ImageHDU</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">hdu</span><span class="p">)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># make sure the EXTEND keyword is in primary HDU if there is extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_extend</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HDUList.append"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a new HDU to the `HDUList`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hdu : HDU object</span>
<span class="sd">            HDU to add to the `HDUList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">_BaseHDU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;HDUList can only append an HDU.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">GroupsHDU</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s">&quot;Can&#39;t append a GroupsHDU to a non-empty HDUList&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">PrimaryHDU</span><span class="p">):</span>
                <span class="c"># You passed a Primary HDU but we need an Extension HDU</span>
                <span class="c"># so create an Extension HDU from the input Primary HDU.</span>
                <span class="c"># TODO: This isn&#39;t necessarily sufficient to copy the HDU;</span>
                <span class="c"># _header_offset and friends need to be copied too.</span>
                <span class="n">hdu</span> <span class="o">=</span> <span class="n">ImageHDU</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="p">(</span><span class="n">PrimaryHDU</span><span class="p">,</span> <span class="n">_NonstandardHDU</span><span class="p">)):</span>
                <span class="c"># You passed in an Extension HDU but we need a Primary</span>
                <span class="c"># HDU.</span>
                <span class="c"># If you provided an ImageHDU then we can convert it to</span>
                <span class="c"># a primary HDU and use that.</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">ImageHDU</span><span class="p">):</span>
                    <span class="n">hdu</span> <span class="o">=</span> <span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># You didn&#39;t provide an ImageHDU so we create a</span>
                    <span class="c"># simple Primary HDU and append that first before</span>
                    <span class="c"># we append the new Extension HDU.</span>
                    <span class="n">phdu</span> <span class="o">=</span> <span class="n">PrimaryHDU</span><span class="p">()</span>
                    <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phdu</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">HDUList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
        <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># make sure the EXTEND keyword is in primary HDU if there is extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_extend</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HDUList.index_of"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.index_of">[docs]</a>    <span class="k">def</span> <span class="nf">index_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the index of an HDU from the `HDUList`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : int, str or tuple of (string, int)</span>
<span class="sd">           The key identifying the HDU.  If ``key`` is a tuple, it is of the</span>
<span class="sd">           form ``(key, ver)`` where ``ver`` is an ``EXTVER`` value that must</span>
<span class="sd">           match the HDU being searched for.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        index : int</span>
<span class="sd">           The index of the HDU in the `HDUList`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">_is_int</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">_key</span><span class="p">,</span> <span class="n">_ver</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">_ver</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_key</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_key</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">nfound</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="c"># &#39;PRIMARY&#39; should always work as a reference to the first HDU</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">name</span> <span class="o">==</span> <span class="n">_key</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_key</span> <span class="o">==</span> <span class="s">&#39;PRIMARY&#39;</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">_ver</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">_ver</span> <span class="o">==</span> <span class="n">hdu</span><span class="o">.</span><span class="n">ver</span><span class="p">)):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="n">idx</span>
                <span class="n">nfound</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">nfound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Extension </span><span class="si">%s</span><span class="s"> not found.&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nfound</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;There are </span><span class="si">%d</span><span class="s"> extensions of </span><span class="si">%s</span><span class="s">.&#39;</span>
                           <span class="o">%</span> <span class="p">(</span><span class="n">nfound</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="HDUList.readall"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.readall">[docs]</a>    <span class="k">def</span> <span class="nf">readall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data of all HDUs into memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
</div>
    <span class="nd">@ignore_sigint</span>
<div class="viewcode-block" id="HDUList.flush"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s">&#39;fix&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Force a write of the `HDUList` back to the file (for append and</span>
<span class="sd">        update modes only).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_verify : str</span>
<span class="sd">            Output verification option.  Must be one of ``&quot;fix&quot;``,</span>
<span class="sd">            ``&quot;silentfix&quot;``, ``&quot;ignore&quot;``, ``&quot;warn&quot;``, or</span>
<span class="sd">            ``&quot;exception&quot;``.  May also be any combination of ``&quot;fix&quot;`` or</span>
<span class="sd">            ``&quot;silentfix&quot;`` with ``&quot;+ignore&quot;``, ``+warn``, or ``+exception&quot;</span>
<span class="sd">            (e.g. ``&quot;fix+warn&quot;``).  See :ref:`verify` for more info.</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            When `True`, print verbose messages</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;append&#39;</span><span class="p">,</span> <span class="s">&#39;update&#39;</span><span class="p">,</span> <span class="s">&#39;ostream&#39;</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Flush for &#39;</span><span class="si">%s</span><span class="s">&#39; mode is not supported.&quot;</span>
                          <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">AstropyUserWarning</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_backup</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;append&#39;</span><span class="p">,</span> <span class="s">&#39;update&#39;</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="c"># The the file doesn&#39;t actually exist anymore for some reason</span>
                <span class="c"># then there&#39;s no point in trying to make a backup</span>
                <span class="n">backup</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;.bak&#39;</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backup</span><span class="p">):</span>
                    <span class="n">backup</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;.bak.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Saving a backup of </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">backup</span><span class="p">),</span> <span class="n">AstropyUserWarning</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">backup</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Failed to save backup to destination </span><span class="si">%s</span><span class="s">: &#39;</span>
                                  <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="n">output_verify</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;append&#39;</span><span class="p">,</span> <span class="s">&#39;ostream&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">extver</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">_header</span><span class="p">[</span><span class="s">&#39;extver&#39;</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">extver</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

                <span class="c"># only append HDU&#39;s which are &quot;new&quot;</span>
                <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span><span class="p">:</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">_prewriteto</span><span class="p">(</span><span class="n">checksum</span><span class="o">=</span><span class="n">hdu</span><span class="o">.</span><span class="n">_output_checksum</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&#39;append HDU&#39;</span><span class="p">,</span> <span class="n">hdu</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">extver</span><span class="p">)</span>
                        <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">hdu</span><span class="o">.</span><span class="n">_postwriteto</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;update&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flush_update</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HDUList.update_extend"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.update_extend">[docs]</a>    <span class="k">def</span> <span class="nf">update_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that if the primary header needs the keyword ``EXTEND`` that</span>
<span class="sd">        it has it and it is correct.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PrimaryHDU</span><span class="p">):</span>
            <span class="c"># A PrimaryHDU will be automatically inserted at some point, but it</span>
            <span class="c"># might not have been added yet</span>
            <span class="k">return</span>

        <span class="n">hdr</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

        <span class="k">if</span> <span class="s">&#39;EXTEND&#39;</span> <span class="ow">in</span> <span class="n">hdr</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">hdr</span><span class="p">[</span><span class="s">&#39;EXTEND&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">hdr</span><span class="p">[</span><span class="s">&#39;EXTEND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hdr</span><span class="p">[</span><span class="s">&#39;NAXIS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;EXTEND&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s">&#39;NAXIS&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s">&#39;NAXIS&#39;</span><span class="p">]</span>
                <span class="n">hdr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;EXTEND&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s">&#39;NAXIS&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="HDUList.writeto"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.writeto">[docs]</a>    <span class="k">def</span> <span class="nf">writeto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s">&#39;exception&#39;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">checksum</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the `HDUList` to a new file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fileobj : file path, file object or file-like object</span>
<span class="sd">            File to write to.  If a file object, must be opened in a</span>
<span class="sd">            writeable mode.</span>

<span class="sd">        output_verify : str</span>
<span class="sd">            Output verification option.  Must be one of ``&quot;fix&quot;``,</span>
<span class="sd">            ``&quot;silentfix&quot;``, ``&quot;ignore&quot;``, ``&quot;warn&quot;``, or</span>
<span class="sd">            ``&quot;exception&quot;``.  May also be any combination of ``&quot;fix&quot;`` or</span>
<span class="sd">            ``&quot;silentfix&quot;`` with ``&quot;+ignore&quot;``, ``+warn``, or ``+exception&quot;</span>
<span class="sd">            (e.g. ``&quot;fix+warn&quot;``).  See :ref:`verify` for more info.</span>

<span class="sd">        clobber : bool</span>
<span class="sd">            When `True`, overwrite the output file if exists.</span>

<span class="sd">        checksum : bool</span>
<span class="sd">            When `True` adds both ``DATASUM`` and ``CHECKSUM`` cards</span>
<span class="sd">            to the headers of all HDU&#39;s written to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;There is nothing to write.&quot;</span><span class="p">,</span> <span class="n">AstropyUserWarning</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="n">output_verify</span><span class="p">)</span>

        <span class="c"># make sure the EXTEND keyword is there if there is extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_extend</span><span class="p">()</span>

        <span class="c"># make note of whether the input file object is already open, in which</span>
        <span class="c"># case we should not close it after writing (that should be the job</span>
        <span class="c"># of the caller)</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fileobj_closed</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>

        <span class="c"># writeto is only for writing a new file from scratch, so the most</span>
        <span class="c"># sensible mode to require is &#39;ostream&#39;.  This can accept an open</span>
        <span class="c"># file object that&#39;s open to write only, or in append/update modes</span>
        <span class="c"># but only if the file doesn&#39;t exist.</span>
        <span class="n">fileobj</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;ostream&#39;</span><span class="p">,</span> <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">)</span>
        <span class="n">hdulist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_prewriteto</span><span class="p">(</span><span class="n">checksum</span><span class="o">=</span><span class="n">checksum</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="n">hdulist</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_postwriteto</span><span class="p">()</span>

        <span class="n">hdulist</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">output_verify</span><span class="o">=</span><span class="n">output_verify</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HDUList.close"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_verify</span><span class="o">=</span><span class="s">&#39;exception&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the associated FITS file and memmap object, if any.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_verify : str</span>
<span class="sd">            Output verification option.  Must be one of ``&quot;fix&quot;``,</span>
<span class="sd">            ``&quot;silentfix&quot;``, ``&quot;ignore&quot;``, ``&quot;warn&quot;``, or</span>
<span class="sd">            ``&quot;exception&quot;``.  May also be any combination of ``&quot;fix&quot;`` or</span>
<span class="sd">            ``&quot;silentfix&quot;`` with ``&quot;+ignore&quot;``, ``+warn``, or ``+exception&quot;</span>
<span class="sd">            (e.g. ``&quot;fix+warn&quot;``).  See :ref:`verify` for more info.</span>

<span class="sd">        verbose : bool</span>
<span class="sd">            When `True`, print out verbose messages.</span>

<span class="sd">        closed : bool</span>
<span class="sd">            When `True`, close the underlying file object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;append&#39;</span><span class="p">,</span> <span class="s">&#39;update&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="n">output_verify</span><span class="o">=</span><span class="n">output_verify</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">closed</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="s">&#39;close&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Give individual HDUs an opportunity to do on-close cleanup</span>
        <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_close</span><span class="p">(</span><span class="n">closed</span><span class="o">=</span><span class="n">closed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HDUList.info"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Summarize the info of the HDUs in this `HDUList`.</span>

<span class="sd">        Note that this function prints its results to the console---it</span>
<span class="sd">        does not return a value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output : file, bool, optional</span>
<span class="sd">            A file-like object to write the output to.  If `False`, does not</span>
<span class="sd">            output to a file and instead returns a list of tuples representing</span>
<span class="sd">            the HDU info.  Writes to ``sys.stdout`` by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;(No file associated with this HDUList)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Filename: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span>
                   <span class="s">&#39;No.    Name         Type      Cards   Dimensions   Format&#39;</span><span class="p">]</span>

        <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%-3d</span><span class="s">  </span><span class="si">%-10s</span><span class="s">  </span><span class="si">%-11s</span><span class="s">  </span><span class="si">%5d</span><span class="s">   </span><span class="si">%-10s</span><span class="s">   </span><span class="si">%s</span><span class="s">   </span><span class="si">%s</span><span class="s">&#39;</span>
        <span class="n">default</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(),</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">default</span><span class="p">):</span>
                <span class="n">summary</span> <span class="o">+=</span> <span class="n">default</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">):]</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,)</span> <span class="o">+</span> <span class="n">summary</span>
            <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format</span> <span class="o">%</span> <span class="n">summary</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
            <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
</div>
<div class="viewcode-block" id="HDUList.filename"><a class="viewcode-back" href="../../../../../io/fits/api/hdulists.html#astropy.io.fits.HDUList.filename">[docs]</a>    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the file name associated with the HDUList object if one exists.</span>
<span class="sd">        Otherwise returns None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        filename : a string containing the file name associated with the</span>
<span class="sd">                   HDUList object if an association exists.  Otherwise returns</span>
<span class="sd">                   None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_readfrom</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">memmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">save_backup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides the implementations from HDUList.fromfile and</span>
<span class="sd">        HDUList.fromstring, both of which wrap this method, as their</span>
<span class="sd">        implementations are largely the same.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">_File</span><span class="p">):</span>
                <span class="c"># instantiate a FITS file object (ffo)</span>
                <span class="n">ffo</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="n">memmap</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ffo</span> <span class="o">=</span> <span class="n">fileobj</span>
            <span class="c"># The pyfits mode is determined by the _File initializer if the</span>
            <span class="c"># supplied mode was None</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">ffo</span><span class="o">.</span><span class="n">mode</span>
            <span class="n">hdulist</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">ffo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># The default mode</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;readonly&#39;</span>

            <span class="n">hdulist</span> <span class="o">=</span> <span class="n">cls</span><span class="p">()</span>
            <span class="c"># This method is currently only called from HDUList.fromstring and</span>
            <span class="c"># HDUList.fromfile.  If fileobj is None then this must be the</span>
            <span class="c"># fromstring case; the data type of ``data`` will be checked in the</span>
            <span class="c"># _BaseHDU.fromstring call.</span>

        <span class="n">hdulist</span><span class="o">.</span><span class="n">_save_backup</span> <span class="o">=</span> <span class="n">save_backup</span>

        <span class="n">saved_compression_enabled</span> <span class="o">=</span> <span class="n">compressed</span><span class="o">.</span><span class="n">COMPRESSION_ENABLED</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s">&#39;disable_image_compression&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;disable_image_compression&#39;</span><span class="p">]):</span>
                <span class="n">compressed</span><span class="o">.</span><span class="n">COMPRESSION_ENABLED</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c"># read all HDUs</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ffo</span><span class="o">.</span><span class="n">writeonly</span><span class="p">:</span>
                            <span class="c"># Output stream--not interested in reading/parsing</span>
                            <span class="c"># the HDUs--just writing to the output file</span>
                            <span class="k">return</span> <span class="n">hdulist</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">hdu</span> <span class="o">=</span> <span class="n">_BaseHDU</span><span class="o">.</span><span class="n">readfrom</span><span class="p">(</span><span class="n">ffo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ffo</span><span class="o">.</span><span class="n">writeonly</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="n">hdu</span> <span class="o">=</span> <span class="n">_BaseHDU</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">hdu</span><span class="o">.</span><span class="n">_data_offset</span> <span class="o">+</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_data_size</span><span class="p">:]</span>
                    <span class="n">hdulist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hdu</span><span class="p">)</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="s">&#39;checksum&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                        <span class="n">hdu</span><span class="o">.</span><span class="n">_output_checksum</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;checksum&#39;</span><span class="p">]</span>
                <span class="c"># check in the case there is extra space after the last HDU or</span>
                <span class="c"># corrupted HDU</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">VerifyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s">&#39;Error validating header for HDU #</span><span class="si">%d</span><span class="s"> (note: Astropy &#39;</span>
                        <span class="s">&#39;uses zero-based indexing).</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span>
                        <span class="s">&#39;There may be extra bytes after the last HDU or the &#39;</span>
                        <span class="s">&#39;file is corrupted.&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hdulist</span><span class="p">),</span> <span class="n">indent</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))),</span> <span class="n">VerifyWarning</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">exc</span>
                    <span class="k">break</span>

            <span class="c"># If we&#39;re trying to read only and no header units were found,</span>
            <span class="c"># raise and exception</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;readonly&#39;</span><span class="p">,</span> <span class="s">&#39;denywrite&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdulist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Empty or corrupt FITS file&#39;</span><span class="p">)</span>

            <span class="c"># initialize/reset attributes to be used in &quot;update/append&quot; mode</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">compressed</span><span class="o">.</span><span class="n">COMPRESSION_ENABLED</span> <span class="o">=</span> <span class="n">saved_compression_enabled</span>

        <span class="k">return</span> <span class="n">hdulist</span>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s">&#39;warn&#39;</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">errs</span> <span class="o">=</span> <span class="n">_ErrList</span><span class="p">([],</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;HDU&#39;</span><span class="p">)</span>

        <span class="c"># the first (0th) element must be a primary HDU</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PrimaryHDU</span><span class="p">))</span> <span class="ow">and</span> \
                             <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_NonstandardHDU</span><span class="p">)):</span>
            <span class="n">err_text</span> <span class="o">=</span> <span class="s">&quot;HDUList&#39;s 0th element is not a primary HDU.&quot;</span>
            <span class="n">fix_text</span> <span class="o">=</span> <span class="s">&#39;Fixed by inserting one as 0th HDU.&#39;</span>

            <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">PrimaryHDU</span><span class="p">())</span>

            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_option</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">err_text</span><span class="o">=</span><span class="n">err_text</span><span class="p">,</span>
                                  <span class="n">fix_text</span><span class="o">=</span><span class="n">fix_text</span><span class="p">,</span> <span class="n">fix</span><span class="o">=</span><span class="n">fix</span><span class="p">)</span>
            <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="s">&#39;EXTEND&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span> <span class="ow">or</span>
                              <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;EXTEND&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">):</span>
            <span class="n">err_text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Primary HDU does not contain an EXTEND keyword &#39;</span>
                        <span class="s">&#39;equal to T even though there are extension HDUs.&#39;</span><span class="p">)</span>
            <span class="n">fix_text</span> <span class="o">=</span> <span class="s">&#39;Fixed by inserting or updating the EXTEND keyword.&#39;</span>

            <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">):</span>
                <span class="n">naxis</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;NAXIS&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">naxis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">after</span> <span class="o">=</span> <span class="s">&#39;NAXIS&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">after</span> <span class="o">=</span> <span class="s">&#39;NAXIS&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">naxis</span><span class="p">)</span>
                <span class="n">header</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;EXTEND&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">after</span><span class="p">)</span>

            <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_option</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">err_text</span><span class="o">=</span><span class="n">err_text</span><span class="p">,</span>
                                        <span class="n">fix_text</span><span class="o">=</span><span class="n">fix_text</span><span class="p">,</span> <span class="n">fix</span><span class="o">=</span><span class="n">fix</span><span class="p">))</span>

        <span class="c"># each element calls their own verify</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hdu</span><span class="p">,</span> <span class="n">ExtensionHDU</span><span class="p">)):</span>
                <span class="n">err_text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;HDUList&#39;s element </span><span class="si">%s</span><span class="s"> is not an extension HDU.&quot;</span> <span class="o">%</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
                <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_option</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">err_text</span><span class="o">=</span><span class="n">err_text</span><span class="p">,</span> <span class="n">fixable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_verify</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">errs</span>

    <span class="k">def</span> <span class="nf">_flush_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements flushing changes to a file in update mode.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c"># Need to all _prewriteto() for each HDU first to determine if</span>
            <span class="c"># resizing will be necessary</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_prewriteto</span><span class="p">(</span><span class="n">checksum</span><span class="o">=</span><span class="n">hdu</span><span class="o">.</span><span class="n">_output_checksum</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wasresized</span><span class="p">()</span>

            <span class="c"># if the HDUList is resized, need to write out the entire contents of</span>
            <span class="c"># the hdulist to the file.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">compression</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_flush_resize</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># if not resized, update in place</span>
                <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="c"># reset the modification attributes after updating</span>
            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">_modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_postwriteto</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_flush_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements flushing changes in update mode when parts of one or more HDU</span>
<span class="sd">        need to be resized.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span>
        <span class="n">old_memmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">memmap</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_tmp_name</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">file_like</span><span class="p">:</span>
            <span class="n">old_mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span>
            <span class="c"># The underlying file is an actual file object.  The HDUList is</span>
            <span class="c"># resized, so we need to write it to a tmp file, delete the</span>
            <span class="c"># original file, and rename the tmp file to the original file.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">compression</span> <span class="o">==</span> <span class="s">&#39;gzip&#39;</span><span class="p">:</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;ab+&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">compression</span> <span class="o">==</span> <span class="s">&#39;bzip2&#39;</span><span class="p">:</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">bz2</span><span class="o">.</span><span class="n">BZ2File</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">name</span>

            <span class="n">hdulist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">new_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;append&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="n">hdulist</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
                <span class="c"># Collect a list of open mmaps to the data; this well be used</span>
                <span class="c"># later.  See below.</span>
                <span class="n">mmaps</span> <span class="o">=</span> <span class="p">[(</span><span class="n">idx</span><span class="p">,</span> <span class="n">_get_array_mmap</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_has_data</span><span class="p">]</span>

            <span class="n">hdulist</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
                <span class="c"># Close all open mmaps to the data.  This is only necessary on</span>
                <span class="c"># Windows, which will not allow a file to be renamed or deleted</span>
                <span class="c"># until all handles to that file have been closed.</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">mmaps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mmap</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c"># reopen the renamed new file with &quot;update&quot; mode</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">old_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">old_mode</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_file</span><span class="p">,</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">):</span>
                <span class="n">old_file</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;rb+&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">old_file</span> <span class="o">=</span> <span class="n">old_name</span>

            <span class="n">ffo</span> <span class="o">=</span> <span class="n">_File</span><span class="p">(</span><span class="n">old_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;update&#39;</span><span class="p">,</span> <span class="n">memmap</span><span class="o">=</span><span class="n">old_memmap</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ffo</span>

            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c"># Need to update the _file attribute and close any open mmaps</span>
                <span class="c"># on each HDU</span>
                <span class="k">if</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_has_data</span> <span class="ow">and</span> <span class="n">_get_array_mmap</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ffo</span>

            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
                <span class="c"># On Windows, all the original data mmaps were closed above.</span>
                <span class="c"># However, it&#39;s possible that the user still has references to</span>
                <span class="c"># the old data which would no longer work (possibly even cause</span>
                <span class="c"># a segfault if they try to access it).  This replaces the</span>
                <span class="c"># buffers used by the original arrays with the buffers of mmap</span>
                <span class="c"># arrays created from the new file.  This seems to work, but</span>
                <span class="c"># it&#39;s a flaming hack and carries no guarantees that it won&#39;t</span>
                <span class="c"># lead to odd behavior in practice.  Better to just not keep</span>
                <span class="c"># references to data from files that had to be resized upon</span>
                <span class="c"># flushing (on Windows--again, this is no problem on Linux).</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mmap</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">mmaps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">mmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">arr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span>
                <span class="k">del</span> <span class="n">mmaps</span>  <span class="c"># Just to be sure</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># The underlying file is not a file object, it is a file like</span>
            <span class="c"># object.  We can&#39;t write out to a file, we must update the file</span>
            <span class="c"># like object in place.  To do this, we write out to a temporary</span>
            <span class="c"># file, then delete the contents in our file like object, then</span>
            <span class="c"># write the contents of the temporary file to the now empty file</span>
            <span class="c"># like object.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">hdulist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ffo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>

            <span class="n">ffo</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ffo</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="n">hdulist</span><span class="p">:</span>
                <span class="n">hdu</span><span class="o">.</span><span class="n">_writeto</span><span class="p">(</span><span class="n">ffo</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="c"># Close the temporary file and delete it.</span>
            <span class="n">hdulist</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hdulist</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># reset the resize attributes after updating</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_header</span><span class="o">.</span><span class="n">_modified</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_new</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">hdu</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">ffo</span>

    <span class="k">def</span> <span class="nf">_wasresized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if any changes to the HDUList will require a file resize</span>
<span class="sd">        when flushing the file.</span>

<span class="sd">        Side effect of setting the objects _resize attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span><span class="p">:</span>

            <span class="c"># determine if any of the HDU is resized</span>
            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c"># Header:</span>
                <span class="n">nbytes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">_header</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">nbytes</span> <span class="o">!=</span> <span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">_data_offset</span> <span class="o">-</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_header_offset</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;One or more header is resized.&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="c"># Data:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_has_data</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">nbytes</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">size</span>
                <span class="n">nbytes</span> <span class="o">=</span> <span class="n">nbytes</span> <span class="o">+</span> <span class="n">_pad_length</span><span class="p">(</span><span class="n">nbytes</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nbytes</span> <span class="o">!=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_data_size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;One or more data area is resized.&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">_data_offset</span> <span class="o">+</span> <span class="n">hdu</span><span class="o">.</span><span class="n">_data_size</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_truncate</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right"> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 12 May 2016. <br/>
  </p>
</footer>
  </body>
</html>