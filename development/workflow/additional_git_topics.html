<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Some other things you might want to do &mdash; Astropy v1.2.dev14978</title>
    
    <link rel="stylesheet" href="../../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.2.dev14978',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev14978" href="../../index.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li>
	<a href="../../index.html">Astropy v1.2.dev14978</a>
	 &raquo;
      </li>
      
       
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="some-other-things-you-might-want-to-do">
<span id="additional-git"></span><h1>Some other things you might want to do<a class="headerlink" href="#some-other-things-you-might-want-to-do" title="Permalink to this headline">¶</a></h1>
<div class="section" id="delete-a-branch-on-github">
<h2>Delete a branch on GitHub<a class="headerlink" href="#delete-a-branch-on-github" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://git-scm.com/">git</a> strongly encourages making a new branch each time you make a change in the
code. At some point you will need to clean up the branches you no longer need&#8211;
that point is <em>after</em> your changes have been accepted if you made a pull request
for those changes.</p>
<p>There are two places to delete the branch: in your local repo and on GitHub.</p>
<p>You can do these independent of each other.</p>
<p>To delete both your local copy AND the GitHub copy from the command line follow
these instructions:</p>
<div class="highlight-python"><div class="highlight"><pre># change to the master branch (if you still have one, otherwise change to
# another branch)
git checkout master

# delete branch locally
# Note: -d tells git to check whether your branch has been merged somewhere
# if it hasn&#39;t, and you delete it, it is gone forever.
#
# Use -D instead to force deletion regardless of merge status
git branch -d my-unwanted-branch

# delete branch on GitHub
git push origin :my-unwanted-branch
</pre></div>
</div>
<p>(Note the colon <code class="docutils literal"><span class="pre">:</span></code> before <code class="docutils literal"><span class="pre">test-branch</span></code>.) See <a class="reference external" href="https://help.github.com/articles/creating-and-deleting-branches-within-your-repository">Github&#8217;s instructions for
deleting a branch</a>
if you want to delete the GitHub copy through GitHub.</p>
</div>
<div class="section" id="several-people-sharing-a-single-repository">
<h2>Several people sharing a single repository<a class="headerlink" href="#several-people-sharing-a-single-repository" title="Permalink to this headline">¶</a></h2>
<p>If you want to work on some stuff with other people, where you are all
committing into the same repository, or even the same branch, then just
share it via GitHub.</p>
<p>First fork Astropy into your account, as from <a class="reference internal" href="get_devel_version.html#fork-a-copy"><span>Make your own copy of Astropy on GitHub</span></a>.</p>
<p>Then, go to your forked repository GitHub page, e.g.,
<code class="docutils literal"><span class="pre">http://github.com/your-user-name/astropy</span></code></p>
<p>Click on the &#8216;Admin&#8217; button, and add anyone else to the repo as a
collaborator:</p>
<blockquote>
<div><img alt="../../_images/pull_button.png" src="../../_images/pull_button.png" />
</div></blockquote>
<p>Now all those people can do:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone git@githhub.com:your-user-name/astropy.git
</pre></div>
</div>
<p>Remember that links starting with <code class="docutils literal"><span class="pre">git&#64;</span></code> use the ssh protocol and are
read-write; links starting with <code class="docutils literal"><span class="pre">git://</span></code> are read-only.</p>
<p>Your collaborators can then commit directly into that repo with the
usual:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -am &#39;ENH - much better code&#39;
git push origin master # pushes directly into your repo
</pre></div>
</div>
</div>
<div class="section" id="explore-your-repository">
<h2>Explore your repository<a class="headerlink" href="#explore-your-repository" title="Permalink to this headline">¶</a></h2>
<p>To see a graphical representation of the repository branches and
commits:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">gitk</span> <span class="o">--</span><span class="nb">all</span>
</pre></div>
</div>
<p>To see a linear list of commits for this branch:</p>
<div class="highlight-python"><div class="highlight"><pre>git log
</pre></div>
</div>
<p>You can also look at the <a class="reference external" href="http://github.com/blog/39-say-hello-to-the-network-graph-visualizer">network graph visualizer</a> for your GitHub
repo.</p>
</div>
<div class="section" id="rebasing-on-trunk">
<span id="rebase-on-trunk"></span><h2>Rebasing on trunk<a class="headerlink" href="#rebasing-on-trunk" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say you thought of some work you&#8217;d like to do. You
<a class="reference internal" href="development_workflow.html#fetch-latest"><span>Fetch the latest Astropy</span></a> and <a class="reference internal" href="development_workflow.html#make-feature-branch"><span>Make a new feature branch</span></a> called
<code class="docutils literal"><span class="pre">cool-feature</span></code>. At this stage trunk is at some commit, let&#8217;s call it E. Now
you make some new commits on your <code class="docutils literal"><span class="pre">cool-feature</span></code> branch, let&#8217;s call them A,
B, C. Maybe your changes take a while, or you come back to them after a while.
In the meantime, trunk has progressed from commit E to commit (say) G:</p>
<div class="highlight-python"><div class="highlight"><pre>      A---B---C cool-feature
     /
D---E---F---G trunk
</pre></div>
</div>
<p>At this stage you consider merging trunk into your feature branch, and you
remember that this here page sternly advises you not to do that, because the
history will get messy. Most of the time you can just ask for a review, and
not worry that trunk has got a little ahead. But sometimes, the changes in
trunk might affect your changes, and you need to harmonize them. In this
situation you may prefer to do a rebase.</p>
<p>Rebase takes your changes (A, B, C) and replays them as if they had been made
to the current state of <code class="docutils literal"><span class="pre">trunk</span></code>. In other words, in this case, it takes the
changes represented by A, B, C and replays them on top of G. After the rebase,
your history will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>              A&#39;--B&#39;--C&#39; cool-feature
             /
D---E---F---G trunk
</pre></div>
</div>
<p>See <a class="reference external" href="http://matthew-brett.github.com/pydagogue/rebase_without_tears.html">rebase without tears</a> for more detail.</p>
<p>To do a rebase on trunk:</p>
<div class="highlight-python"><div class="highlight"><pre># Update the mirror of trunk
git fetch upstream

# Go to the feature branch
git checkout cool-feature

# Make a backup in case you mess up
git branch tmp cool-feature

# Rebase cool-feature onto trunk
git rebase --onto upstream/master upstream/master cool-feature
</pre></div>
</div>
<p>In this situation, where you are already on branch <code class="docutils literal"><span class="pre">cool-feature</span></code>, the last
command can be written more succinctly as:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase upstream/master
</pre></div>
</div>
<p>When all looks good you can delete your backup branch:</p>
<div class="highlight-python"><div class="highlight"><pre>git branch -D tmp
</pre></div>
</div>
<p>If it doesn&#8217;t look good you may need to have a look at
<a class="reference internal" href="#recovering-from-mess-up"><span>Recovering from mess-ups</span></a>.</p>
<p>If you have made changes to files that have also changed in trunk, this may
generate merge conflicts that you need to resolve - see the <a class="reference external" href="http://schacon.github.com/git/git-rebase.html">git rebase</a> man
page for some instructions at the end of the &#8220;Description&#8221; section. There is
some related help on merging in the git user manual - see <a class="reference external" href="http://schacon.github.com/git/user-manual.html#resolving-a-merge">resolving a
merge</a>.</p>
<p>If your feature branch is already on GitHub and you rebase, you will have to
force push the branch; a normal push would give an error. If the branch you
rebased is called <code class="docutils literal"><span class="pre">cool-feature</span></code> and your GitHub fork is available as the
remote called <code class="docutils literal"><span class="pre">origin</span></code>, you use this command to force-push:</p>
<div class="highlight-python"><div class="highlight"><pre>git push -f origin cool-feature
</pre></div>
</div>
<p>Note that this will overwrite the branch on GitHub, i.e. this is one of the few
ways you can actually lose commits with git. Also note that it is never allowed
to force push to the main astropy repo (typically called <code class="docutils literal"><span class="pre">upstream</span></code>), because
this would re-write commit history and thus cause problems for all others.</p>
</div>
<div class="section" id="recovering-from-mess-ups">
<span id="recovering-from-mess-up"></span><h2>Recovering from mess-ups<a class="headerlink" href="#recovering-from-mess-ups" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, you mess up merges or rebases. Luckily, in git it is relatively
straightforward to recover from such mistakes.</p>
<p>If you mess up during a rebase:</p>
<div class="highlight-python"><div class="highlight"><pre>git rebase --abort
</pre></div>
</div>
<p>If you notice you messed up after the rebase:</p>
<div class="highlight-python"><div class="highlight"><pre># Reset branch back to the saved point
git reset --hard tmp
</pre></div>
</div>
<p>If you forgot to make a backup branch:</p>
<div class="highlight-python"><div class="highlight"><pre># Look at the reflog of the branch
git reflog show cool-feature

8630830 cool-feature@{0}: commit: BUG: io: close file handles immediately
278dd2a cool-feature@{1}: rebase finished: refs/heads/my-feature-branch onto 11ee694744f2552d
26aa21a cool-feature@{2}: commit: BUG: lib: make seek_gzip_factory not leak gzip obj
...

# Reset the branch to where it was before the botched rebase
git reset --hard cool-feature@{2}
</pre></div>
</div>
</div>
<div class="section" id="rewriting-commit-history">
<span id="id1"></span><h2>Rewriting commit history<a class="headerlink" href="#rewriting-commit-history" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Do this only for your own feature branches.</p>
</div>
<p>There&#8217;s an embarrassing typo in a commit you made? Or perhaps the you
made several false starts you would like the posterity not to see.</p>
<p>This can be done via <em>interactive rebasing</em>.</p>
<p>Suppose that the commit history looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>git log --oneline
eadc391 Fix some remaining bugs
a815645 Modify it so that it works
2dec1ac Fix a few bugs + disable
13d7934 First implementation
6ad92e5 * masked is now an instance of a new object, MaskedConstant
29001ed Add pre-nep for a couple of structured_array_extensions.
...
</pre></div>
</div>
<p>and <code class="docutils literal"><span class="pre">6ad92e5</span></code> is the last commit in the <code class="docutils literal"><span class="pre">cool-feature</span></code> branch. Suppose we
want to make the following changes:</p>
<ul class="simple">
<li>Rewrite the commit message for <code class="docutils literal"><span class="pre">13d7934</span></code> to something more sensible.</li>
<li>Combine the commits <code class="docutils literal"><span class="pre">2dec1ac</span></code>, <code class="docutils literal"><span class="pre">a815645</span></code>, <code class="docutils literal"><span class="pre">eadc391</span></code> into a single one.</li>
</ul>
<p>We do as follows:</p>
<div class="highlight-python"><div class="highlight"><pre># make a backup of the current state
git branch tmp HEAD
# interactive rebase
git rebase -i 6ad92e5
</pre></div>
</div>
<p>This will open an editor with the following text in it:</p>
<div class="highlight-python"><div class="highlight"><pre>pick 13d7934 First implementation
pick 2dec1ac Fix a few bugs + disable
pick a815645 Modify it so that it works
pick eadc391 Fix some remaining bugs

# Rebase 6ad92e5..eadc391 onto 6ad92e5
#
# Commands:
#  p, pick = use commit
#  r, reword = use commit, but edit the commit message
#  e, edit = use commit, but stop for amending
#  s, squash = use commit, but meld into previous commit
#  f, fixup = like &quot;squash&quot;, but discard this commit&#39;s log message
#
# If you remove a line here THAT COMMIT WILL BE LOST.
# However, if you remove everything, the rebase will be aborted.
#
</pre></div>
</div>
<p>To achieve what we want, we will make the following changes to it:</p>
<div class="highlight-python"><div class="highlight"><pre>r 13d7934 First implementation
pick 2dec1ac Fix a few bugs + disable
f a815645 Modify it so that it works
f eadc391 Fix some remaining bugs
</pre></div>
</div>
<p>This means that (i) we want to edit the commit message for <code class="docutils literal"><span class="pre">13d7934</span></code>, and
(ii) collapse the last three commits into one. Now we save and quit the
editor.</p>
<p>Git will then immediately bring up an editor for editing the commit message.
After revising it, we get the output:</p>
<div class="highlight-python"><div class="highlight"><pre>[detached HEAD 721fc64] FOO: First implementation
 2 files changed, 199 insertions(+), 66 deletions(-)
[detached HEAD 0f22701] Fix a few bugs + disable
 1 files changed, 79 insertions(+), 61 deletions(-)
Successfully rebased and updated refs/heads/my-feature-branch.
</pre></div>
</div>
<p>and the history looks now like this:</p>
<div class="highlight-python"><div class="highlight"><pre>0f22701 Fix a few bugs + disable
721fc64 ENH: Sophisticated feature
6ad92e5 * masked is now an instance of a new object, MaskedConstant
</pre></div>
</div>
<p>If it went wrong, recovery is again possible as explained <a class="reference internal" href="#recovering-from-mess-up"><span>above</span></a>.</p>
</div>
<div class="section" id="converting-a-github-issue-to-a-pull-request">
<h2>Converting a GitHub issue to a pull request<a class="headerlink" href="#converting-a-github-issue-to-a-pull-request" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you have a branch in your own GitHub repository designed to
fix one particular issue.  If that issue is listed on GitHub, a natural
way to address it is to convert the issue to a pull request by
attaching code containing the fix for the issue. This can currently only be
done using the GitHub API (there&#8217;s no button or anything on the web
site that does it, at least as of 2/6/2012). There are two options to do this,
both of which only work if you own the repository or have the ability to commit
directly to it (for Astropy, that means being an Astropy maintainer):</p>
<ul>
<li><p class="first">You can use the script at <a class="reference external" href="https://gist.github.com/1750715">https://gist.github.com/1750715</a>, which will
do this for you automatically — just download the script and run it as
a python command-line script, using the <code class="docutils literal"><span class="pre">python</span> <span class="pre">issue2pr.py</span> <span class="pre">--help</span></code>
option to determine the precise usage.</p>
</li>
<li><p class="first">You can use the <code class="docutils literal"><span class="pre">hub</span></code> command-line utility provided <a class="reference external" href="https://github.com/defunkt/hub">here</a> by GitHub. Once installed, you can
attach a branch to a pull request by doing:</p>
<div class="highlight-python"><div class="highlight"><pre>hub pull-request -i &lt;ID&gt; -b astropy:master -h &lt;USER&gt;:&lt;BRANCH&gt;
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">&lt;ID&gt;</span></code> is the ID of the issue, <code class="docutils literal"><span class="pre">&lt;USER&gt;</span></code> is the username, and
<code class="docutils literal"><span class="pre">&lt;BRANCH&gt;</span></code> is the name of the branch you want to attach to the
issue. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>hub pull-request -i 42 -b astropy:master -h galahad:feature
</pre></div>
</div>
<p>will attach the <code class="docutils literal"><span class="pre">feature</span></code> branch from <code class="docutils literal"><span class="pre">galahad</span></code>&#8216;s Astropy
repository to issue 42.</p>
<p>The <code class="docutils literal"><span class="pre">hub</span></code> command can do a lot more to interact with GitHub, so be
sure to read their documentation. For example, you can fetch all
branches of a repository for a given user by doing:</p>
<div class="highlight-python"><div class="highlight"><pre>hub fetch &lt;USER&gt;
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="merge-commits-and-cherry-picks">
<span id="id2"></span><h2>Merge commits and cherry picks<a class="headerlink" href="#merge-commits-and-cherry-picks" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say that you have a fork (origin) on GitHub of the main Astropy
repository (upstream).  Your fork is up to date with upstream&#8217;s master branch
and you&#8217;ve made some commits branching off from it on your own branch:</p>
<div class="highlight-python"><div class="highlight"><pre>upstream:

   master
      |
A--B--C

origin:

 upstream/master
      |
A--B--C
       \
        D--E
           |
       issue-branch
</pre></div>
</div>
<p>Then say you make a pull request of issue-branch against Astroy&#8217;s master, and
the pull request is accepted and merged.  When GitHub merges the pull request
it&#8217;s basically doing the following in the upstream repository:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git checkout master
$ git remote add yourfork file:///path/to/your/fork/astropy
$ git fetch yourfork
$ git merge --no-ff yourfork/issue-branch
</pre></div>
</div>
<p>Because it always uses <code class="docutils literal"><span class="pre">--no-ff</span></code> we always get a merge commit (it is possible
to manually do a fast-forward merge of a pull request, but we rarely ever do
that).  Now the main Astropy repository looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>upstream:

          master
             |
A--B--C------F
       \    /
        D--E
           |
    yourfork/issue-branch
</pre></div>
</div>
<p>where &#8220;F&#8221; is the merge commit GitHub just made in upstream.</p>
<p>When you do cherry-pick of a non-merge commit, say you want to just cherry-pick
&#8220;D&#8221; from the branch, what happens is it does a diff of &#8220;D&#8221; with its parent (in
this case &#8220;C&#8221;) and applies that diff as a patch to whatever your HEAD is.</p>
<p>The problem with a merge commit, such as &#8220;F&#8221;, is that &#8220;F&#8221; has two parents: &#8220;C&#8221;
and &#8220;E&#8221;.  It doesn&#8217;t know whether to apply the diff of &#8220;F&#8221; with &#8220;C&#8221; or the diff
of &#8220;F&#8221; with &#8220;E&#8221;.  Clearly in this case of backporting a pull request to a bug
fix branch we want to apply everything that changed on master from the merge,
so we want the diff of &#8220;F&#8221; with &#8220;C&#8221;.</p>
<p>Since GitHub was on <code class="docutils literal"><span class="pre">master</span></code> when it did <code class="docutils literal"><span class="pre">git</span> <span class="pre">merge</span> <span class="pre">yourfork/issue-branch</span></code>, the
last commit in <code class="docutils literal"><span class="pre">master</span></code> is the first parent.  Basically whatever HEAD you&#8217;re on
when you do the merge is the first parent, and the tip you&#8217;re merging from is
the second parent (octopus merge gets more complicated but only a little, and
that doesn&#8217;t apply to pull requests).  Since parents are numbered starting from
&#8220;1&#8221; then we will always cherry-pick merge commits with <code class="docutils literal"><span class="pre">-m</span> <span class="pre">1</span></code> in this case.</p>
<p>That&#8217;s not to say that the cherry-pick will always apply cleanly.  Say in
upstream we also have a backport branch that we want to cherry pick &#8220;F&#8221; onto:</p>
<div class="highlight-python"><div class="highlight"><pre>upstream:

  backport
     |
     G       master
    /          |
A--B----C------F
         \    /
          D--E
</pre></div>
</div>
<p>We would do:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git checkout backport
$ git cherry-pick -m 1 F
</pre></div>
</div>
<p>But this applies the diff of &#8220;F&#8221; with &#8220;C&#8221;, not of &#8220;F&#8221; with &#8220;G&#8221;.  So clearly
there&#8217;s potential for conflicts and incongruity here.  But this will work like
any merge that has conflicts&#8211;you can resolve any conflicts manually and then
commit.  As long as the fix being merged is reasonably self-contained this
usually requires little effort.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Some other things you might want to do</a><ul>
<li><a class="reference internal" href="#delete-a-branch-on-github">Delete a branch on GitHub</a></li>
<li><a class="reference internal" href="#several-people-sharing-a-single-repository">Several people sharing a single repository</a></li>
<li><a class="reference internal" href="#explore-your-repository">Explore your repository</a></li>
<li><a class="reference internal" href="#rebasing-on-trunk">Rebasing on trunk</a></li>
<li><a class="reference internal" href="#recovering-from-mess-ups">Recovering from mess-ups</a></li>
<li><a class="reference internal" href="#rewriting-commit-history">Rewriting commit history</a></li>
<li><a class="reference internal" href="#converting-a-github-issue-to-a-pull-request">Converting a GitHub issue to a pull request</a></li>
<li><a class="reference internal" href="#merge-commits-and-cherry-picks">Merge commits and cherry picks</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/development/workflow/additional_git_topics.rst">Edit This Page on Github</a> &nbsp;
    <a href="../../_sources/development/workflow/additional_git_topics.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.5. &nbsp;
    Last built 29 Apr 2016. <br/>
  </p>
</footer>
  </body>
</html>