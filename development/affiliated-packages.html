<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How to create and maintain an Astropy affiliated package &mdash; Astropy v1.2.dev14997</title>
    
    <link rel="stylesheet" href="../_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.dev14997',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/astropy_logo.ico"/>
    <link rel="top" title="Astropy v1.2.dev14997" href="../index.html" />
    <link rel="next" title="Full Changelog" href="../changelog.html" />
    <link rel="prev" title="Workflow for Maintainers" href="workflow/maintainer_workflow.html" />
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../_static/copybutton.js"></script>


  </head>
  <body role="document">
<div class="topbar">
  <a class="brand" title="Documentation Home" href="../index.html"><span id="logotext1">astro</span><span id="logotext2">py</span><span id="logotext3">:docs</span></a>
  <ul>
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="../genindex.html">Index</a></li>
    <li><a title="Module Index" href="../py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="../changelog.html" title="Full Changelog">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="workflow/maintainer_workflow.html" title="Workflow for Maintainers">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="../index.html">Astropy v1.2.dev14997</a>
	 &raquo;
      </li>
      
      <li>How to create and maintain an Astropy affiliated package</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-create-and-maintain-an-astropy-affiliated-package">
<h1>How to create and maintain an Astropy affiliated package<a class="headerlink" href="#how-to-create-and-maintain-an-astropy-affiliated-package" title="Permalink to this headline">¶</a></h1>
<p>If you run into any problems, don&#8217;t hesitate to ask for help on the
astropy-dev mailing list!</p>
<p>The <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> repository provides a template for packages that are
affiliated with the <a class="reference external" href="http://astropy.org">Astropy</a> project. This package design mirrors the
layout of the main <a class="reference external" href="http://astropy.org">Astropy</a> repository, as well as reusing much of the
helper code used to organize <a class="reference external" href="http://astropy.org">Astropy</a>. The instructions below describe how
to take this template and adjust it for your particular affiliated package,
as well as how to update your package to the latest version of the package
template.</p>
<p>There are two main ways you can use this template layout to create a new
package:</p>
<ol class="arabic simple">
<li>simply copy over the files you need manually</li>
<li>start from a fork of the package-template repository</li>
</ol>
<p>There are advantages and disadvantages to both methods. In the first case your
repository history will be clean and you will only include the files you really
need. However, when updating you will need to make sure you update all the
files manually. In the second case, the history of your package will be
cluttered with all the commits from the <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> repository, but if
done properly this can be easier to update in future since it simply involves
pulling from the latest version of the <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> repository and then
merging in the changes (and resolving conflicts).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The instructions below assume you are using git for version control,
as is used by the Astropy repository. If this is not the case,
hopefully it will be clear from context what to do with your
particular VCS.</p>
</div>
<p>Everywhere below that the text <code class="docutils literal"><span class="pre">&lt;packagename&gt;</span></code> is shown, replace it with the
name of your particular package. In fact, you can do this automatically by
entering your package name in the box below:</p>
<form id="myform">
  Package name: <input type="text" name="packagename">
  <button>Update package name</button>
</form>
<br><div class="section" id="managing-the-template-files-manually">
<h2>Managing the template files manually<a class="headerlink" href="#managing-the-template-files-manually" title="Permalink to this headline">¶</a></h2>
<div class="section" id="starting-a-new-package">
<h3>Starting a new package<a class="headerlink" href="#starting-a-new-package" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Clone the <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> package so that we can have access to the
files, but do not go inside it - instead, create another empty repository
into which we will copy the required files:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone https://github.com/astropy/package-template.git template
mkdir &lt;packagename&gt;
cd &lt;packagename&gt;
git init
</pre></div>
</div>
</li>
<li><p class="first">The <a class="reference external" href="https://github.com/astropy/package-template">package-template</a> infrastructure relies on the <a class="reference external" href="https://github.com/astropy/astropy-helpers">astropy-helpers</a>
package, and we recommend adding this as a sub-module so as to easily be
able to bundle it in releases of affiliated packages:</p>
<div class="highlight-python"><div class="highlight"><pre>git submodule add https://github.com/astropy/astropy-helpers.git astropy_helpers
</pre></div>
</div>
</li>
<li><p class="first">Copy over the following files from the package template (these define the
bare minimum of what is needed) and add them to the repository:</p>
<div class="highlight-python"><div class="highlight"><pre># .gitignore specifies which types of files to ignore in the repository
cp ../template/.gitignore .

# MANIFEST.in specifies which files to include in a tar file release
cp ../template/MANIFEST.in .

# ah_bootstrap.py is used by setup.py to use the astropy-helpers
cp ../template/ah_bootstrap.py .

# ez_setup.py is used by setup.py to be able to get setuptools on-the-fly
cp ../template/ez_setup.py .

# setup.cfg contains details about your package - edit it after copying!
# Note: it is important that the package_name variable matches the name you
#       are using for your package.
cp ../template/setup.cfg .

# edit the VERSION variable and if applicable, the package_data values,
# the rest can be kept as-is
# Note: If your package data directory has a sub-directory, you HAVE TO
#       break &#39;data/*&#39; to &#39;data/*.*&#39; and &#39;data/subdir/*&#39; (two different
#       appends). If you do not have any package data, you can just comment
#       out the line that appends &#39;data/*&#39;.
cp ../template/setup.py .
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Before proceeding, make sure you have edited <code class="docutils literal"><span class="pre">setup.cfg</span></code> and
<code class="docutils literal"><span class="pre">setup.py</span></code> as indicated above!</p>
</div>
<p>Once you have edited <code class="docutils literal"><span class="pre">setup.cfg</span></code> and <code class="docutils literal"><span class="pre">setup.py</span></code>, you can commit the
changes:</p>
<div class="highlight-python"><div class="highlight"><pre>git add .gitignore MANIFEST.in ah_bootstrap.py ez_setup.py setup.cfg setup.py
</pre></div>
</div>
</li>
<li><p class="first">Next, you can create a directory for your package&#8217;s source code, which will
usually also be called the same name as your package. In this directory
you can copy over the following files:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir &lt;packagename&gt;

cp ../template/packagename/__init__.py &lt;packagename&gt;/
cp ../template/packagename/_astropy_init.py &lt;packagename&gt;/

# edit &lt;packagename&gt;/__init__.py to change the docstring and change the
# example import ``from example_mod import *`` to whatever is needed for
# your package. If you don&#39;t want to try out any specific code yet, just
# replace the import by ``pass``.
</pre></div>
</div>
<p>The main purpose of the <code class="docutils literal"><span class="pre">_astropy_init.py</span></code> file is to set up the
<code class="docutils literal"><span class="pre">test()</span></code> command at the root of your package so that you can do
<code class="docutils literal"><span class="pre">&lt;packagename&gt;.test()</span></code>. This file is imported into <code class="docutils literal"><span class="pre">__init__</span></code>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Before proceeding, make sure you have edited <code class="docutils literal"><span class="pre">__init__.py</span></code> as
indicated above!</p>
</div>
<p>Once you have made the above changes, you can commit the files:</p>
<div class="highlight-python"><div class="highlight"><pre>git add &lt;packagename&gt;/__init__.py
git add &lt;packagename&gt;/_astropy_init.py
</pre></div>
</div>
</li>
<li><p class="first">In order to benefit from the pytest plugins in Astropy, you should also
copy over the <code class="docutils literal"><span class="pre">conftest.py</span></code> file to your repository:</p>
<div class="highlight-python"><div class="highlight"><pre>cp ../template/packagename/conftest.py &lt;packagename&gt;/

git add &lt;packagename&gt;/conftest.py
</pre></div>
</div>
<p>You can also uncomment the line <code class="docutils literal"><span class="pre">enable_deprecations_as_exceptions()</span></code> if
you want deprecation warnings to make tests fail. There are also
options to customize the information to be printed when running the
tests. The package template has comments in the <code class="docutils literal"><span class="pre">conftest.py</span></code> file that
indicate what they are.</p>
</li>
<li><p class="first">If you are interested in accurate coverage test results, copy over the
<code class="docutils literal"><span class="pre">coveragerc</span></code> and the <code class="docutils literal"><span class="pre">setup_package.py</span></code> files to your repository (the
latter ensures that <code class="docutils literal"><span class="pre">coveragerc</span></code> gets installed with the package:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir &lt;packagename&gt;/tests/
cp ../template/packagename/tests/__init__.py &lt;packagename&gt;/tests
cp ../template/packagename/tests/setup_package.py &lt;packagename&gt;/tests
cp ../template/packagename/tests/coveragerc &lt;packagename&gt;/tests

git add &lt;packagename&gt;/tests/__init__.py
git add &lt;packagename&gt;/tests/setup_package.py
git add &lt;packagename&gt;/tests/coveragerc
</pre></div>
</div>
<p>to your repository. When you run tests with with <code class="docutils literal"><span class="pre">--coverage</span></code> option this
file will be used to exclude certain files that should not typically be
included. Note that you don&#8217;t need to change the <code class="docutils literal"><span class="pre">{packagename}</span></code> string in
<code class="docutils literal"><span class="pre">coveragerc</span></code> - this gets changed automatically using the package name
defined in <code class="docutils literal"><span class="pre">setup.cfg</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span></code> commands will not work until you
have made your first commit, as shown in the last step of these
instructions.</p>
</div>
</li>
<li><p class="first">To set up the infrastructure to build the documentation, copy over the
following files into a new directory called <code class="docutils literal"><span class="pre">docs</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir docs
cp -r ../template/docs/_templates docs/
cp ../template/docs/Makefile docs/
cp ../template/docs/conf.py docs/
cp ../template/docs/make.bat docs/
touch docs/index.rst  # creates empty page
git add docs/_templates docs/Makefile docs/conf.py docs/make.bat docs/index.rst
</pre></div>
</div>
<p>you can later start adding content to <code class="docutils literal"><span class="pre">index.rst</span></code> and other documentation
files.</p>
</li>
<li><p class="first">Add a <code class="docutils literal"><span class="pre">README.md</span></code> file to your repository, describing what the package
does, and for example how to install it and any required dependencies:</p>
<div class="highlight-python"><div class="highlight"><pre>git add README.md
</pre></div>
</div>
</li>
<li><p class="first">Finally, if you plan on using Travis for continuous integration, copy over
the <code class="docutils literal"><span class="pre">.travis.yml</span></code> file and edit it:</p>
<div class="highlight-python"><div class="highlight"><pre>cp ../template/.travis.yml .
# edit .travis.yml
git add .travis.yml
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Before proceeding, make sure you have edited <code class="docutils literal"><span class="pre">.travis.yml</span></code> as
indicated above!</p>
</div>
</li>
<li><p class="first">Now you are ready to make your first commit:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -m &quot;Initial layout for package&quot;
</pre></div>
</div>
</li>
<li><p class="first">You can test that your package works correctly by doing e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py build
python setup.py test --coverage
python setup.py build_docs
</pre></div>
</div>
<p>If you have any issues that you cannot fix, feel free to ask us on the
<a class="reference external" href="http://groups.google.com/group/astropy-dev">astropy-dev mailing list</a>!</p>
</li>
</ol>
</div>
<div class="section" id="updating-to-the-latest-template-files">
<h3>Updating to the latest template files<a class="headerlink" href="#updating-to-the-latest-template-files" title="Permalink to this headline">¶</a></h3>
<p>From time to time we will make changes to the package-template to fix bugs or
add functionality. Updating to the latest version is simple - simply check
the <a class="reference external" href="https://github.com/astropy/package-template/blob/master/TEMPLATE_CHANGES.md">TEMPLATE_CHANGES.md</a> file, which provides a changelog of the package
template. You can also re-copy over all the files listed in the above section
and see if any of the changes should be committed (some of the changes will
be reverting some of your edits, so do not include those!). Remember to
update the astropy-helpers sub-module to the latest stable version, and
update the corresponding <code class="docutils literal"><span class="pre">ah_bootstrap.py</span></code> file, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>cd astropy_helpers
git fetch origin
git checkout v0.4.3
cd ..
cp astropy_helpers/ah_bootstrap.py .
git add astropy_helpers ah_bootstrap.py
git commit -m &quot;Updated astropy-helpers to v0.4.3&quot;
</pre></div>
</div>
<p>You can find out what the latest version of astropy-helpers is by checking the
<a class="reference external" href="https://pypi.python.org/pypi/astropy-helpers/">astropy-helpers</a> entry on
PyPI.</p>
</div>
</div>
<div class="section" id="managing-the-template-files-via-git">
<h2>Managing the template files via git<a class="headerlink" href="#managing-the-template-files-via-git" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Starting a new package<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Before reading this we recommend reading over the <a class="reference internal" href="#managing-the-template-files-manually">Managing the template
files manually</a> section since this explains what many of the files do.</p>
<ol class="arabic">
<li><p class="first">Make sure <a class="reference external" href="http://astropy.org">Astropy</a> is installed, as the template depends in part on
Astropy to do its setup.</p>
</li>
<li><p class="first">You may have already done this if you are looking at this file locally, but
if not, you will need to obtain a copy of the package template.  Assuming
you have <a class="reference external" href="http://git-scm.com/">git</a> installed, just do:</p>
<div class="highlight-python"><div class="highlight"><pre>git clone git://github.com/astropy/package-template.git &lt;packagename&gt;
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div>This will download the latest version of the template from <a class="reference external" href="http://github.com">github</a> and
place it in a directory named <code class="docutils literal"><span class="pre">&lt;packagename&gt;</span></code>.</div></blockquote>
<ol class="arabic">
<li><p class="first">Go into the directory you just created, and open the <code class="docutils literal"><span class="pre">setup.cfg</span></code>
file with your favorite text editor.  Edit the settings in the
<code class="docutils literal"><span class="pre">metadata</span></code> section.  These values will be used to automatically
replace special placeholders in the affiliated package template.</p>
<ol class="arabic simple">
<li>Change the <code class="docutils literal"><span class="pre">package_name</span></code> variable to whatever you decide your
package should be named. By tradition/very strong suggestion,
python package names should be all lower-case.</li>
<li>Change the <code class="docutils literal"><span class="pre">description</span></code> variable to a short (one or few
sentence) description of your package.</li>
<li>Add your name and email address by changing the <code class="docutils literal"><span class="pre">author</span></code> and
<code class="docutils literal"><span class="pre">author_email</span></code> variables.</li>
<li>If your affiliated package has a website, change <code class="docutils literal"><span class="pre">url</span></code> to point
to that site.  Otherwise, you can leave it pointing to <a class="reference external" href="http://astropy.org">Astropy</a>
or just delete it.</li>
<li>Exit out of your text editor</li>
</ol>
</li>
<li><p class="first">Update the main package docstring in <code class="docutils literal"><span class="pre">&lt;packagename&gt;/__init__.py</span></code>.</p>
</li>
<li><p class="first">Decide what license you want to use to release your source code. If
you don&#8217;t care and/or are fine with the Astropy license, just edit
the file <code class="docutils literal"><span class="pre">licenses/LICENSE.rst</span></code> with your name (or your
collaboration&#8217;s name) at the top as the licensees. Otherwise, make
sure to replace that file with whatever license you prefer, and
update the <code class="docutils literal"><span class="pre">license</span></code> variable in <code class="docutils literal"><span class="pre">setup.cfg</span></code> to reflect your
choice of license. You also may need to update the comment at the
top of <code class="docutils literal"><span class="pre">&lt;packagename&gt;/__init__.py</span></code> to reflect your choice of
license.</p>
</li>
<li><p class="first">Take a moment to look over the <code class="docutils literal"><span class="pre">&lt;packagename&gt;/example_mod.py</span></code>,
<code class="docutils literal"><span class="pre">&lt;packagename&gt;/tests/test_example.py</span></code>, <code class="docutils literal"><span class="pre">scripts/script_example</span></code>,
and <code class="docutils literal"><span class="pre">&lt;packagename&gt;/example_c.pyx</span></code> files, as well as the
<code class="docutils literal"><span class="pre">&lt;packagename&gt;/example_subpkg</span></code> directory. These are examples of a
pure-python module, a test script, an example command-line script, a
<a class="reference external" href="http://cython.org/">Cython</a> module, and a sub-package, respectively. (<a class="reference external" href="http://cython.org/">Cython</a> is a
way to compile python-like code to C to make it run faster - see the
project&#8217;s web site for details). These are provided as examples of
standard way to lay these out. Once you understand these, though,
you&#8217;ll want to delete them (and later replace with your own):</p>
<div class="highlight-python"><div class="highlight"><pre>git rm scripts/script_example
git rm &lt;packagename&gt;/example_c.pyx
git rm &lt;packagename&gt;/tests/test_example.py
git rm -r &lt;packagename&gt;/example_subpkg
git commit -m &quot;removed examples from package template&quot;
</pre></div>
</div>
</li>
<li><p class="first">Optional: If you&#8217;re hosting your source code on github, you can
enable a sphinx extension that will link documentation pages
directly to github&#8217;s web site. To do this, set <code class="docutils literal"><span class="pre">edit_on_github</span></code> in
<code class="docutils literal"><span class="pre">setup.cfg</span></code> to <code class="docutils literal"><span class="pre">True</span></code> and set <code class="docutils literal"><span class="pre">github_project</span></code> to the name of
your project on github.</p>
</li>
<li><p class="first">Move the main source directory to reflect the name of your package.
To tell your DVCS about this move, you should use it, and not <code class="docutils literal"><span class="pre">mv</span></code>
directly, to make the move.  For example, with git:</p>
<div class="highlight-python"><div class="highlight"><pre>git mv packagename &lt;packagename&gt;
</pre></div>
</div>
</li>
<li><p class="first">Update the names of the documentation files to match your package&#8217;s name.
First open <code class="docutils literal"><span class="pre">docs/index.rst</span></code> in a text editor and change the text
<code class="docutils literal"><span class="pre">&quot;packagename/index.rst&quot;</span></code> to e.g., <code class="docutils literal"><span class="pre">&quot;&lt;packagename&gt;/index.rst&quot;</span></code>.  Then do:</p>
<div class="highlight-python"><div class="highlight"><pre>git add docs/index.rst
git mv docs/packagename docs/&lt;packagename&gt;
</pre></div>
</div>
</li>
<li><p class="first">Edit the <code class="docutils literal"><span class="pre">README.rst</span></code> file, deleting all of the content and replacing it
with a short description of your affiliated package.</p>
</li>
<li><p class="first">Open <code class="docutils literal"><span class="pre">docs/&lt;packagename&gt;/index.rst</span></code> and you can start writing the documentation
for your package, but at least replace <code class="docutils literal"><span class="pre">packagename</span></code> in <code class="docutils literal"><span class="pre">automodapi::</span></code>
with your package name.</p>
</li>
<li><p class="first">Now tell git to remember the changes you just made:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -a -m &quot;Adjusted for new project &lt;packagename&gt;&quot;
</pre></div>
</div>
</li>
<li><p class="first">(This step assumes your affiliated package is hosted as part of the astropy
organization on Github.  If it&#8217;s instead hosted somewhere else, just adjust
the URL in the instructions below to match wherever your repository lives)
Now you will want to tell git that it should be pushing and pulling updates
to the repository of <em>your</em> project, rather than the package template:</p>
<div class="highlight-python"><div class="highlight"><pre>git remote rename origin template
git remote add upstream git@github.com:astropy/&lt;packagename&gt;.git
</pre></div>
</div>
<p>Now that it is pointing to the correct master, you should push everything up
to your project and make sure that your local master is tied to your project
rather than the template.  You&#8217;ll only be able to do this if your github
repository is empty (if not, add the <code class="docutils literal"><span class="pre">-f</span></code> option to the <code class="docutils literal"><span class="pre">push</span></code>
command - that will overwrite whatever is there):</p>
<div class="highlight-python"><div class="highlight"><pre>git push upstream master
git branch master --set-upstream upstream/master
</pre></div>
</div>
</li>
<li><p class="first">(optional) If you are adopting the standard workflow used by <a class="reference external" href="http://astropy.org">Astropy</a> with
github, you will also want to set up a fork of the repo on your own account,
by going to the Github page <a class="reference external" href="https://github.com/astropy">https://github.com/astropy</a>/&lt;packagename&gt; and clicking
the &#8220;fork&#8221; button on the upper right.  Then run the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre>git remote add origin git@github.com:yourgithubusername/&lt;packagename&gt;.git
git branch master --set-upstream origin/master
</pre></div>
</div>
<p>Now you can push, pull, and branch whatever you want in your local fork
without affecting the official version, but when you want to push something
up to the main repository, just switch to the appropriate branch and do
<code class="docutils literal"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">upstream</span> <span class="pre">master</span></code>.</p>
<p>Additionally, you can set things up to make it easier to pull future
changes to the package template to your affiliated package.  Add a remote
for the package template:</p>
<div class="highlight-python"><div class="highlight"><pre>git remote add template git@github.com:astropy/package-template.git
</pre></div>
</div>
<p>Then, each time you want to pull in changes to the package template:</p>
<div class="highlight-python"><div class="highlight"><pre>git fetch template
git fetch upstream

# Make your master match the upstream master.  This will destroy
# any unmerged commits on your master (which you shouldn&#39;t be doing
# work on anyway, according to the standard workflow).
git checkout master
git reset --hard upstream/master

# Merge any recent changes from the package-template
git merge template/master

# ...possibly resolve any conflicts...

# Push to upstream master
git push upstream master
</pre></div>
</div>
</li>
<li><p class="first">You should register your package on <a class="reference external" href="https://travis-ci.org">https://travis-ci.org</a> and modify the
<code class="docutils literal"><span class="pre">.travis.yml</span></code> file to make the build pass. This will continuously test
your package for each commit, even pull requests against your main repository
will be automatically tested, so that you notice when something breaks.
For further information see
<a class="reference external" href="https://github.com/astropy/astropy/wiki/Continuous-Integration">here</a>
and for lot&#8217;s of example <code class="docutils literal"><span class="pre">.travis.yml</span></code> build configurations see
<a class="reference external" href="https://github.com/astropy/astropy/wiki/travis-ci-test-status">here</a>.
Generally you should aim to always have your <code class="docutils literal"><span class="pre">master</span></code> branch work with
the latest stable as well as the latest development version of astropy
(i.e. the astropy git master branch) and the same versions of python and
numpy supported by astropy. The template <code class="docutils literal"><span class="pre">.travis.yml</span></code> covers those
versions; in some circumstances you may need to limit the versions your
package covers.</p>
</li>
<li><p class="first">If you register your package with coveralls.io, then you will need
to modify the <code class="docutils literal"><span class="pre">coveralls</span> <span class="pre">--rcfile</span></code> line in <code class="docutils literal"><span class="pre">.travis.yml</span></code> file to
replace <code class="docutils literal"><span class="pre">packagename</span></code> with the name of your package.</p>
</li>
<li><p class="first">If you want the documentation for your project to be hosted by
<a class="reference external" href="https://readthedocs.org">ReadTheDocs</a>, then you need to setup an
account there. The following entries in &#8220;Advanced Settings&#8221; for your
package on <a class="reference external" href="https://readthedocs.org">ReadTheDocs</a> should work:</p>
<ul class="simple">
<li>activate <code class="docutils literal"><span class="pre">Install</span> <span class="pre">your</span> <span class="pre">project</span> <span class="pre">inside</span> <span class="pre">a</span> <span class="pre">virtualenv</span> <span class="pre">using</span> <span class="pre">setup.py</span> <span class="pre">install</span></code></li>
<li>Requirements file: <code class="docutils literal"><span class="pre">docs/rtd-pip-requirements</span></code></li>
<li>activate <code class="docutils literal"><span class="pre">Give</span> <span class="pre">the</span> <span class="pre">virtual</span> <span class="pre">environment</span> <span class="pre">access</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">global</span> <span class="pre">site-packages</span> <span class="pre">dir.</span></code></li>
</ul>
<p>All other settings can stay on their default value.</p>
</li>
<li><p class="first">You&#8217;re now ready to start doing actual work on your affiliated package.  You
will probably want to read over the developer guidelines of the Astropy
documentation, and if you are hosting your code in GitHub, you might also
want to read the <a class="reference external" href="http://help.github.com/">Github help</a> to ensure you know
how to push your code to GitHub and some recommended workflows that work for
the core Astropy project.</p>
</li>
<li><p class="first">Once you have started work on the affiliated package, you should register
your package with the Astropy affiliated package registry. Instructions for
doing this will be provided on the <a class="reference external" href="http://astropy.org">Astropy</a> website.</p>
</li>
<li><p class="first">Good luck with your code and your science!</p>
</li>
</ol>
</div>
<div class="section" id="id3">
<h3>Updating to the latest template files<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="releasing-an-affiliated-package">
<h2>Releasing an affiliated package<a class="headerlink" href="#releasing-an-affiliated-package" title="Permalink to this headline">¶</a></h2>
<p>You can release an affiliated package using the steps given below. In these
instructions, we assume that the changelog file is named <code class="docutils literal"><span class="pre">CHANGES.rst</span></code>, like
for the astropy core package. If instead you use Markdown, then you should
replace <code class="docutils literal"><span class="pre">CHANGES.rst</span></code> by <code class="docutils literal"><span class="pre">CHANGES.md</span></code> in the instructions.</p>
<ol class="arabic">
<li><p class="first">Make sure that Travis and any other continuous integration is passing.</p>
</li>
<li><p class="first">Update the <code class="docutils literal"><span class="pre">CHANGES.rst</span></code> file to make sure that all the changes are listed,
and update the release date, which should currently be set to
<code class="docutils literal"><span class="pre">unreleased</span></code>, to the current date in <code class="docutils literal"><span class="pre">yyyy-mm-dd</span></code> format.</p>
</li>
<li><p class="first">Update the version number in <code class="docutils literal"><span class="pre">setup.py</span></code> to the version you&#8217;re about to
release, without the <code class="docutils literal"><span class="pre">.dev</span></code> suffix (e.g. <code class="docutils literal"><span class="pre">0.1</span></code>).</p>
</li>
<li><p class="first">Run <code class="docutils literal"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> to remove any untracked files (WARNING: this will
permanently remove any files that have not been previously committed, so
make sure that you don&#8217;t need to keep any of these files).</p>
</li>
<li><p class="first">Run:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py build sdist --format=gztar
</pre></div>
</div>
<p>and make sure that generated file is good to
go by going inside <code class="docutils literal"><span class="pre">dist</span></code>, expanding the tar file, going inside the
expanded directory, and running the tests with:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py test
</pre></div>
</div>
<p>You may need to add the <code class="docutils literal"><span class="pre">--remote-data</span></code> flag or any other flags that you
normally add when fully testing your affiliated package.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Running <code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span> <span class="pre">sdist</span></code> runs two setup commands in
succession.  First it runs <code class="docutils literal"><span class="pre">build</span></code>, then immediately runs <code class="docutils literal"><span class="pre">sdist</span></code>
to create the source distribution.  The reason to do this is that
there are several generated source files that must be included in the
source distribution for it to be valid.  Running <code class="docutils literal"><span class="pre">build</span></code> first
ensures that those files will be generated and packaged in the source
distribution.</p>
</div>
</li>
<li><p class="first">Go back to the root of the directory and remove the generated files with:</p>
<div class="highlight-python"><div class="highlight"><pre>git clean -fxd
</pre></div>
</div>
</li>
<li><p class="first">Add the changes to <code class="docutils literal"><span class="pre">CHANGES.rst</span></code> and <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>git add CHANGES.rst setup.py
</pre></div>
</div>
<p>and commit with message:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -m &quot;Preparing release &lt;version&gt;&quot;
</pre></div>
</div>
</li>
<li><p class="first">Tag commit with <code class="docutils literal"><span class="pre">v&lt;version&gt;</span></code>, optionally signing with the <code class="docutils literal"><span class="pre">-s</span></code> option:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag v&lt;version&gt;
</pre></div>
</div>
</li>
<li><p class="first">Change <code class="docutils literal"><span class="pre">VERSION</span></code> in <code class="docutils literal"><span class="pre">setup.py</span></code> to next version number, but with a
<code class="docutils literal"><span class="pre">.dev</span></code> suffix at the end (e.g. <code class="docutils literal"><span class="pre">0.2.dev</span></code>). Add a new section to
<code class="docutils literal"><span class="pre">CHANGES.rst</span></code> for next version, with a single entry <code class="docutils literal"><span class="pre">No</span> <span class="pre">changes</span> <span class="pre">yet</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>0.2 (unreleased)
----------------

- No changes yet
</pre></div>
</div>
</li>
<li><p class="first">Add the changes to <code class="docutils literal"><span class="pre">CHANGES.rst</span></code> and <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>git add CHANGES.rst setup.py
</pre></div>
</div>
<p>and commit with message:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -m &quot;Back to development: &lt;next_version&gt;&quot;
</pre></div>
</div>
</li>
<li><p class="first">Check out the release commit with <code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">v&lt;version&gt;</span></code>.
Run <code class="docutils literal"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> to remove any non-committed files.</p>
</li>
<li><p class="first">(optional) Run the tests in an environment that mocks up a &#8220;typical user&#8221;
scenario. This is not strictly necessary because you ran the tests above, but
it can sometimes be useful to catch subtle bugs that might come from you
using a customized developer environment.  For more on setting up virtual
environments, see <a class="reference internal" href="workflow/virtual_pythons.html#virtual-envs"><span>Python virtual environments</span></a>, but for the sake of example we will
assume you&#8217;re using <a class="reference external" href="http://conda.pydata.org/docs/">Anaconda</a>. Do:</p>
<div class="highlight-python"><div class="highlight"><pre>conda create -n myaffilpkg_rel_test astropy &lt;any more dependencies here&gt;
source activate myaffilpkg_rel_test
python setup.py sdist
cd dist
pip install myaffilpkg-version.tar.gz
python -c &#39;import myaffilpkg; myaffilpkg.test()&#39;
source deactivate
cd &lt;back to your source&gt;
</pre></div>
</div>
<p>You may want to repeat this for other combinations of dependencies if you think
your users might have other relevant packages installed.  Assuming the tests
all pass, you can proceed on.</p>
</li>
<li><p class="first">If you did the previous step, do <code class="docutils literal"><span class="pre">git</span> <span class="pre">clean</span> <span class="pre">-fxd</span></code> again to remove anything
you made there. Then either release with:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py register build sdist --format=gztar upload
</pre></div>
</div>
<p>or, if you are concerned about security, you can also use <code class="docutils literal"><span class="pre">twine</span></code> as described
in <a class="reference external" href="https://packaging.python.org/en/latest/tutorial.html#uploading-your-project-to-pypi">these</a>
instructions. Either way, check that the entry on PyPI is correct, and that
the tarfile is present.</p>
</li>
<li><p class="first">Go back to the master branch and push your changes to github:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout master
git push --tags origin master
</pre></div>
</div>
<p>Once you have done this, if you use readthedocs, trigger a <code class="docutils literal"><span class="pre">latest</span></code> build
then go to the project settings, and under <strong>Versions</strong> you should see the
tag you just pushed. Select the tag to activate it, and save.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The instructions above assume that you do not make use of bug fix
branches in your workflow. If you do wish to create a bug fix branch,
we recommend that you read over the more complete astropy
<a class="reference internal" href="releasing.html"><em>Release Procedures</em></a> and adapt these for your package.</p>
</div>
<script>

function get_url_vars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}

packagename = get_url_vars()["packagename"]
if(packagename) {
  document.body.innerHTML = document.body.innerHTML.replace(/&lt;packagename&gt;/g, packagename);
}
</script></div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">How to create and maintain an Astropy affiliated package</a><ul>
<li><a class="reference internal" href="#managing-the-template-files-manually">Managing the template files manually</a><ul>
<li><a class="reference internal" href="#starting-a-new-package">Starting a new package</a></li>
<li><a class="reference internal" href="#updating-to-the-latest-template-files">Updating to the latest template files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-the-template-files-via-git">Managing the template files via git</a><ul>
<li><a class="reference internal" href="#id1">Starting a new package</a></li>
<li><a class="reference internal" href="#id3">Updating to the latest template files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#releasing-an-affiliated-package">Releasing an affiliated package</a></li>
</ul>
</li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="http://github.com/astropy/astropy/tree/master/docs/development/affiliated-packages.rst">Edit This Page on Github</a> &nbsp;
    <a href="../_sources/development/affiliated-packages.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2011-2016, The Astropy Developers.<br/>
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1. &nbsp;
    Last built 12 May 2016. <br/>
  </p>
</footer>
  </body>
</html>